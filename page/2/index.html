<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.leoyanblog.com","root":"/","scheme":"Muse","version":"8.0.0-rc.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="离经不叛道，特立不独行。">
<meta property="og:type" content="website">
<meta property="og:title" content="LeoYan Blog">
<meta property="og:url" content="http://www.leoyanblog.com/page/2/index.html">
<meta property="og:site_name" content="LeoYan Blog">
<meta property="og:description" content="离经不叛道，特立不独行。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Leo Yan">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://www.leoyanblog.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>LeoYan Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">LeoYan Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">技术分享，生活记录。</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.leoyanblog.com/post/2017/03/19.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Leo Yan">
      <meta itemprop="description" content="离经不叛道，特立不独行。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeoYan Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/post/2017/03/19.html" class="post-title-link" itemprop="url">Android 之 ContentProvider (一) 相关知识</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-03-19 10:00:00" itemprop="dateCreated datePublished" datetime="2017-03-19T10:00:00+08:00">2017-03-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2017-03-27 11:52:20" itemprop="dateModified" datetime="2017-03-27T11:52:20+08:00">2017-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">四大组件</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6/ContentProvider/" itemprop="url" rel="index"><span itemprop="name">ContentProvider</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>转载请注明出处：<a href="http://www.leoyanblog.com">www.leoyanblog.com</a></p>
<p>本文出自 LeoYan 的博客</p>
<p>本文同步发表于我的微信公众号，扫一扫文章底部的二维码或在微信搜索 LeoYan 即可关注。</p>
</blockquote>
<h2 id="ContentProvider-是什么？"><a href="#ContentProvider-是什么？" class="headerlink" title="ContentProvider 是什么？"></a>ContentProvider 是什么？</h2><p>&#8195;&#8195;ContentProvider(数据提供者)是应用程序之间共享数据的一种接口机制，是一种更为高级的数据共享方法。</p>
<ul>
<li><p>ContentProvider 可以指定需要共享的数据，而其他应用程序则可以在不知道数据来源、路径的情况下，对共享数据进行增删改查等操作。</p>
</li>
<li><p>在 Android 系统中，许多 Android 系统内置的数据也是通过 ContentProvider 提供给用户使用，例如通讯录、音视频文件和图像文件等。</p>
</li>
</ul>
<h2 id="URI"><a href="#URI" class="headerlink" title="URI"></a>URI</h2><p>&#8195;&#8195;URI（统一资源标识符）代表要操作的数据，可以用来标识每个 ContentProvider，这样你就可以通过指定的URI找到想要的 ContentProvider, 从中获取或修改数据。</p>
<p>&#8195;&#8195;在 Android 中 URI 的格式如下所示：</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">content:</span>//<span class="keyword">com</span>.leo.peopleprovider/people/<span class="number">7</span></span><br></pre></td></tr></table></figure>

<p>&#8195;&#8195;它可以分为如下三部分：</p>
<ul>
<li>content://</li>
</ul>
<p>&#8195;&#8195;这个部分是 Android 的 ContentProvider 规定的，就像是上网的协议默认是 http:// 一样。暴露 ContentProvider、访问 ContentProvider 的协议默认是 content:// 。</p>
<ul>
<li>com.leo.peopleprovider</li>
</ul>
<p>&#8195;&#8195;这个部分就是 ContentProvider 的 authorities (主机名)。是唯一标识符，用来定位 ContentProvider。系统就是由这个部分来找到操作哪个 ContentProvider 的。</p>
<ul>
<li>/people</li>
</ul>
<p>&#8195;&#8195;资源部分（或者说数据部分）。指向一个对象集合，一般用表的名字。当访问者需要访问不同资源时，这个部分是动态改变的。</p>
<ul>
<li>/7</li>
</ul>
<p>&#8195;&#8195;指向特定的记录，这里表示操作 people 表 id 为 7 的记录。如果要操作 people 表中 id 为 7 的记录的 name 字段，这部分应为 <strong>/7/name</strong> 即可。</p>
<blockquote>
<p>其中 /people 部分和 /7 部分：是每个 ContentProvider 内部的路径部分</p>
</blockquote>
<blockquote>
<p>URI 模式匹配通配符</p>
<p>*&#8195; 匹配的任意长度的任何有效字符的字符串。 </p>
<p>＃&#8195;匹配的任意长度的数字字符的字符串。 </p>
<p>如：</p>
<p>&#8195;&#8195;content://com.leo.peopleprovider/* &#8195;&#8195;匹配 provider 的任何内容 url </p>
<p>&#8195;&#8195;content://com.leo.peopleprovider/people/# &#8195;&#8195;匹配 people 表中的所有行</p>
</blockquote>
<p>　　</p>
<h3 id="MIME"><a href="#MIME" class="headerlink" title="MIME"></a>MIME</h3><p>&#8195;&#8195;MIME，全称 Multipurpose Internet Mail Extensions，多功能 Internet 邮件扩充服务。MIME 类型就是设定某种扩展名的文件用一种应用程序来打开的方式类型，当该扩展名文件被访问的时候，浏览器会自动使用指定应用程序来打开。多用于指定一些客户端自定义的文件名，以及一些媒体文件打开方式。Android 中的工作方式也是类似的，在 ContentProvider 的 getType(Uri) 方法中，可以显示的返回一个 MIME 类型，该方法返回一个字符串，可以是任意的字符串，当我们显示的返回该 MIME 类型的时候，相当于通过该方法的验证，Provider 可以识别自身其他方法返回的 Cursor 的内容，不需要在进行更多的验证；如果返回其他的字符串 (非 android 能够识别的 MIME 类型，例如直接返回当前的包名)，则 Provider 在执行其他方法后，返回 Cursor 类型的时候，需要再次进行验证。MIME 类型一般包含两部分，如：
　　</p>
<blockquote>
<p>text/html</p>
<p>text/css</p>
<p>text/xml</p>
<p>application/pdf</p>
</blockquote>
<p>&#8195;&#8195;分为类型和子类型，Android 遵循类似的约定来定义 MIME 类型，每个内容类型的 Android MIME 类型有两种形式：多条记录（集合）和单条记录。</p>
<p>&#8195;&#8195;集合记录：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vnd<span class="selector-class">.android</span><span class="selector-class">.cursor</span>.dir/自定义</span><br></pre></td></tr></table></figure>

<p>&#8195;&#8195;单条记录：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vnd<span class="selector-class">.android</span><span class="selector-class">.cursor</span>.item/自定义</span><br></pre></td></tr></table></figure>

<p>&#8195;&#8195;vnd 表示这些类型和子类型具有非标准的、供应商特定的形式。Android 中类型已经固定好了，不能更改，只能区别是集合还是单条具体记录，子类型可以按照格式自己填写。</p>
<p>&#8195;&#8195;在使用 Intent 时，会用到 MIME，根据 Mimetype 打开符合条件的活动。</p>
<p>&#8195;&#8195;下面分别介绍 Android 系统提供了两个用于操作 Uri 的工具类：ContentUris 和 UriMatcher。</p>
<h3 id="ContentUris"><a href="#ContentUris" class="headerlink" title="ContentUris"></a>ContentUris</h3><p>&#8195;&#8195;ContetnUris 包含一个便利的函数 withAppendedId() 来向 URI 追加一个 id。</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Uri uri = <span class="module-access"><span class="module"><span class="identifier">Uri</span>.</span></span>parse(<span class="string">"content://com.leo.peopleprovider/people"</span>)</span><br><span class="line">Uri resultUri = <span class="module-access"><span class="module"><span class="identifier">ContentUris</span>.</span></span><span class="keyword">with</span><span class="constructor">AppendedId(<span class="params">uri</span>, 7)</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成后的Uri为：content://com.leo.peopleprovider/people/7</span></span><br></pre></td></tr></table></figure>

<p>&#8195;&#8195;同时提供 parseId(uri) 方法用于从 URL 中获取 ID:</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Uri uri = <span class="module-access"><span class="module"><span class="identifier">Uri</span>.</span></span>parse(<span class="string">"content://com.leo.peopleprovider/people/7"</span>)</span><br><span class="line">long personid = <span class="module-access"><span class="module"><span class="identifier">ContentUris</span>.</span></span>parse<span class="constructor">Id(<span class="params">uri</span>)</span>;</span><br><span class="line"><span class="comment">// 获取的结果为:7</span></span><br></pre></td></tr></table></figure>

<h3 id="UriMatcher"><a href="#UriMatcher" class="headerlink" title="UriMatcher"></a>UriMatcher</h3><p>&#8195;&#8195;UriMatcher 本质上是一个文本过滤器，用在 ContentProvider 中帮助我们过滤，分辨出查询者想要查询哪个数据表。</p>
<p>&#8195;&#8195;举例说明：</p>
<ul>
<li>第一步，初始化：</li>
</ul>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UriMatcher matcher = <span class="keyword">new</span> <span class="type">UriMatcher</span>(UriMatcher.NO_MATCH);</span><br><span class="line"><span class="comment">// 常量UriMatcher.NO_MATCH表示不匹配任何路径的返回码</span></span><br></pre></td></tr></table></figure>

<ul>
<li>第二步，注册需要的Uri：</li>
</ul>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MULTIPLE_PEOPLE 和 SINGLE_PEOPLE 是两个 int 型数据</span></span><br><span class="line"><span class="selector-tag">matcher</span><span class="selector-class">.addURI</span>(<span class="string">"com.leo.peopleprovider"</span>, <span class="string">"people"</span>, MULTIPLE_PEOPLE);</span><br><span class="line"><span class="selector-tag">matcher</span><span class="selector-class">.addURI</span>(<span class="string">"com.leo.peopleprovider"</span>, <span class="string">"people/#"</span>, SINGLE_PEOPLE);</span><br><span class="line"><span class="comment">// 如果 match() 方法匹配 content://com.leo.peopleprovider/people 路径，返回匹配码为 MULTIPLE_PEOPLE</span></span><br></pre></td></tr></table></figure>

<ul>
<li>第三部，与已经注册的Uri进行匹配:</li>
</ul>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * 如果操作集合，则必须以 vnd.android.cursor.dir 开头 </span></span><br><span class="line"><span class="comment"> * 如果操作非集合，则必须以 vnd.android.cursor.item 开头 </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="meta">@Override</span>  </span><br><span class="line">public <span class="built_in">String</span> getType(<span class="built_in">Uri</span> uri) &#123;  </span><br><span class="line"><span class="built_in">Uri</span> uri = <span class="built_in">Uri</span>.parse(<span class="string">"content://"</span> + <span class="string">"com.leo.peopleprovider"</span> + <span class="string">"/people"</span>);  </span><br><span class="line">    <span class="keyword">switch</span>(matcher.match(uri))&#123;  </span><br><span class="line">    <span class="keyword">case</span> MULTIPLE_PEOPLE:  </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"vnd.android.cursor.dir/people"</span>;  </span><br><span class="line">    <span class="keyword">case</span> SINGLE_PEOPLE:  </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"vnd.android.cursor.item/people"</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ContentProvider-的主要方法"><a href="#ContentProvider-的主要方法" class="headerlink" title="ContentProvider 的主要方法"></a>ContentProvider 的主要方法</h2><blockquote>
<p>public boolean onCreate()</p>
</blockquote>
<p>&#8195;&#8195;ContentProvider 创建后或打开系统后其它应用第一次访问该 ContentProvider 时调用。</p>
<blockquote>
<p>public Uri insert(Uri uri, ContentValues values)</p>
</blockquote>
<p>&#8195;&#8195;外部应用向 ContentProvider 中添加数据。</p>
<blockquote>
<p>public int delete(Uri uri, String selection, String[] selectionArgs)</p>
</blockquote>
<p>&#8195;&#8195;外部应用从 ContentProvider 删除数据。</p>
<blockquote>
<p>public int update(Uri uri, ContentValues values, String selection, String[] selectionArgs)：</p>
</blockquote>
<p>&#8195;&#8195;外部应用更新 ContentProvider 中的数据。</p>
<blockquote>
<p>public Cursor query(Uri uri, String[] projection, String selection, String[] selectionArgs, String sortOrder)　</p>
</blockquote>
<p>&#8195;&#8195;供外部应用从 ContentProvider 中获取数据。
　</p>
<blockquote>
<p>public String getType(Uri uri)</p>
</blockquote>
<p>&#8195;&#8195;该方法用于返回当前 Url 所代表数据的 MIME 类型。</p>
<h2 id="ContentResolver"><a href="#ContentResolver" class="headerlink" title="ContentResolver"></a>ContentResolver</h2><p>&#8195;&#8195;ContentResolver 通过 URI 来查询 ContentProvider 中提供的数据。除了 URI 以外，还必须知道需要获取的数据段的名称，以及此数据段的数据类型。如果你需要获取一个特定的记录，你就必须知道当前记录的 ID，也就是 URI 中 /7 那部分。</p>
<p>&#8195;&#8195;ContentResolver 类提供了与 ContentProvider 类相同签名的四个方法：</p>
<blockquote>
<p>public Uri insert(Uri uri, ContentValues values)　// 添加</p>
<p>public int delete(Uri uri, String selection, String[] selectionArgs)　// 删除</p>
<p>public int update(Uri uri, ContentValues values, String selection, String[] selectionArgs)　// 更新</p>
<p>public Cursor query(Uri uri, String[] projection, String selection, String[] selectionArgs, String sortOrder)　// 获取</p>
</blockquote>
<p>&#8195;&#8195;实例代码：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">ContentResolver resolver =  get<span class="constructor">ContentResolver()</span>;</span><br><span class="line">Uri uri = <span class="module-access"><span class="module"><span class="identifier">Uri</span>.</span></span>parse(<span class="string">"content://com.leo.peopleprovider/people"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加一条记录</span></span><br><span class="line">ContentValues values = <span class="keyword">new</span> <span class="constructor">ContentValues()</span>;</span><br><span class="line">values.put(<span class="string">"name"</span>, <span class="string">"fanrunqi"</span>);</span><br><span class="line">values.put(<span class="string">"age"</span>, <span class="number">24</span>);</span><br><span class="line">resolver.insert(uri, values);  </span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 user 表中所有记录</span></span><br><span class="line">Cursor cursor = resolver.query(uri, null, null, null, <span class="string">"userid desc"</span>);</span><br><span class="line"><span class="keyword">while</span>(cursor.move<span class="constructor">ToNext()</span>)&#123;</span><br><span class="line">   <span class="comment">// 操作</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把 id 为 1 的记录的 name 字段值更改新为 finch</span></span><br><span class="line">ContentValues updateValues = <span class="keyword">new</span> <span class="constructor">ContentValues()</span>;</span><br><span class="line">updateValues.put(<span class="string">"name"</span>, <span class="string">"finch"</span>);</span><br><span class="line">Uri updateIdUri = <span class="module-access"><span class="module"><span class="identifier">ContentUris</span>.</span></span><span class="keyword">with</span><span class="constructor">AppendedId(<span class="params">uri</span>, 1)</span>;</span><br><span class="line">resolver.update(updateIdUri, updateValues, null, null);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除 id 为 2 的记录</span></span><br><span class="line">Uri deleteIdUri = <span class="module-access"><span class="module"><span class="identifier">ContentUris</span>.</span></span><span class="keyword">with</span><span class="constructor">AppendedId(<span class="params">uri</span>, 2)</span>;</span><br><span class="line">resolver.delete(deleteIdUri, null, null);</span><br></pre></td></tr></table></figure>

<h2 id="ContentObserver"><a href="#ContentObserver" class="headerlink" title="ContentObserver"></a>ContentObserver</h2><p>&#8195;&#8195;ContentObserver (内容观察者)，目的是观察特定 Uri 引起的数据库的变化，继而做一些相应的处理，它类似于数据库技术中的触发器(Trigger)，当 ContentObserver 所观察的 Uri 发生变化时，便会触发它.</p>
<p>&#8195;&#8195;下面是使用内容观察者监听短信的例子：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">public <span class="keyword">class</span> MainActivity extends Activity &#123;</span><br><span class="line"> </span><br><span class="line">    @Override</span><br><span class="line">    protected void on<span class="constructor">Create(Bundle <span class="params">savedInstanceState</span>)</span> &#123;</span><br><span class="line">        super.on<span class="constructor">Create(<span class="params">savedInstanceState</span>)</span>;</span><br><span class="line">        set<span class="constructor">ContentView(R.<span class="params">layout</span>.<span class="params">activity_main</span>)</span>;</span><br><span class="line">         </span><br><span class="line">        <span class="comment">// 注册观察者Observser    </span></span><br><span class="line">        this.get<span class="constructor">ContentResolver()</span>.register<span class="constructor">ContentObserver(Uri.<span class="params">parse</span>(<span class="string">"content://sms"</span>)</span>,<span class="literal">true</span>,<span class="keyword">new</span> <span class="constructor">SMSObserver(<span class="params">new</span> Handler()</span>));</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> final <span class="keyword">class</span> SMSObserver extends ContentObserver &#123;</span><br><span class="line"> </span><br><span class="line">        public <span class="constructor">SMSObserver(Handler <span class="params">handler</span>)</span> &#123;</span><br><span class="line">            super(handler);</span><br><span class="line">        &#125;</span><br><span class="line">     </span><br><span class="line">        @Override</span><br><span class="line">        public void on<span class="constructor">Change(<span class="params">boolean</span> <span class="params">selfChange</span>)</span> &#123;</span><br><span class="line">     </span><br><span class="line">            Cursor cursor = <span class="module-access"><span class="module"><span class="identifier">MainActivity</span>.</span></span>this.get<span class="constructor">ContentResolver()</span>.query(<span class="module-access"><span class="module"><span class="identifier">Uri</span>.</span></span>parse(<span class="string">"content://sms/inbox"</span>), null, null, null, null);</span><br><span class="line">     </span><br><span class="line">            <span class="keyword">while</span> (cursor.move<span class="constructor">ToNext()</span>) &#123;</span><br><span class="line">                StringBuilder sb = <span class="keyword">new</span> <span class="constructor">StringBuilder()</span>;</span><br><span class="line">    </span><br><span class="line">                sb.append(<span class="string">"address="</span>).append(</span><br><span class="line">                        cursor.get<span class="constructor">String(<span class="params">cursor</span>.<span class="params">getColumnIndex</span>(<span class="string">"address"</span>)</span>));</span><br><span class="line">    </span><br><span class="line">                sb.append(<span class="string">";subject="</span>).append(</span><br><span class="line">                        cursor.get<span class="constructor">String(<span class="params">cursor</span>.<span class="params">getColumnIndex</span>(<span class="string">"subject"</span>)</span>));</span><br><span class="line">    </span><br><span class="line">                sb.append(<span class="string">";body="</span>).append(</span><br><span class="line">                        cursor.get<span class="constructor">String(<span class="params">cursor</span>.<span class="params">getColumnIndex</span>(<span class="string">"body"</span>)</span>));</span><br><span class="line">    </span><br><span class="line">                sb.append(<span class="string">";time="</span>).append(</span><br><span class="line">                        cursor.get<span class="constructor">Long(<span class="params">cursor</span>.<span class="params">getColumnIndex</span>(<span class="string">"date"</span>)</span>));</span><br><span class="line">    </span><br><span class="line">                <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">"--------has Receivered SMS::"</span> + sb.<span class="keyword">to</span><span class="constructor">String()</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&#8195;&#8195;同时可以在 ContentProvider 发生数据变化时调用<br>getContentResolver().notifyChange(uri, null) 来通知注册在此 URI 上的访问者。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">UserContentProvider</span> <span class="keyword">extends</span> <span class="title">ContentProvider</span> </span>&#123;</span><br><span class="line">   public <span class="type">Uri</span> insert(<span class="type">Uri</span> uri, <span class="type">ContentValues</span> values) &#123;</span><br><span class="line">      db.insert(<span class="string">"user"</span>, <span class="string">"userid"</span>, values);</span><br><span class="line">      getContext().getContentResolver().notifyChange(uri, <span class="literal">null</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>　</p>
<p>　</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.leoyanblog.com/post/2017/03/16.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Leo Yan">
      <meta itemprop="description" content="离经不叛道，特立不独行。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeoYan Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/post/2017/03/16.html" class="post-title-link" itemprop="url">关于手机摄影的几点建议（四）后期修图</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-03-16 10:00:00" itemprop="dateCreated datePublished" datetime="2017-03-16T10:00:00+08:00">2017-03-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2017-03-27 11:52:53" itemprop="dateModified" datetime="2017-03-27T11:52:53+08:00">2017-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%91%84%E5%BD%B1/" itemprop="url" rel="index"><span itemprop="name">摄影</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%91%84%E5%BD%B1/%E6%89%8B%E6%9C%BA%E6%91%84%E5%BD%B1/" itemprop="url" rel="index"><span itemprop="name">手机摄影</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>转载请注明出处：<a href="http://www.leoyanblog.com">www.leoyanblog.com</a></p>
<p>本文出自 LeoYan 的博客</p>
<p>本文同步发表于我的微信公众号，扫一扫文章底部的二维码或在微信搜索 LeoYan 即可关注。</p>
</blockquote>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_40_1.jpg" alt="sy_40_1"></p>
<h2 id="修图App"><a href="#修图App" class="headerlink" title="修图App"></a>修图App</h2><p>关于文中所提及的APP下载地址（豌豆荚）</p>
<p>&#8195;&#8195;VSCO：<a href="http://www.wandoujia.com/apps/com.vsco.cam" target="_blank" rel="noopener">http://www.wandoujia.com/apps/com.vsco.cam</a></p>
<p>&#8195;&#8195;Snapseed：<a href="http://www.wandoujia.com/apps/com.niksoftware.snapseed" target="_blank" rel="noopener">http://www.wandoujia.com/apps/com.niksoftware.snapseed</a></p>
<p>&#8195;&#8195;Layout：<a href="http://www.wandoujia.com/apps/com.instagram.layout" target="_blank" rel="noopener">http://www.wandoujia.com/apps/com.instagram.layout</a></p>
<p>&#8195;&#8195;图片合成器：<a href="http://www.wandoujia.com/apps/cn.poco.pMix" target="_blank" rel="noopener">http://www.wandoujia.com/apps/cn.poco.pMix</a></p>
<h2 id="相关文章"><a href="#相关文章" class="headerlink" title="相关文章"></a>相关文章</h2><p><a href="http://www.leoyanblog.com/post/2017/03/13.html">关于手机摄影的几点建议（一）从零开始</a></p>
<p><a href="http://www.leoyanblog.com/post/2017/03/14.html">关于手机摄影的几点建议（二）如何构图</a></p>
<p><a href="http://www.leoyanblog.com/post/2017/03/15.html">关于手机摄影的几点建议（三）光与弱光</a></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>&#8195;&#8195;这次后期篇我介绍四款后期 APP，即第一期所建议的四个 APP，我会从一张张图的示范给给你们讲一下我对于后期修图的理解，这次的图片示例来自不同的设备，大部分为T1，我会一一注明，话不多说，进入正题。</p>
<h2 id="VSCO"><a href="#VSCO" class="headerlink" title="VSCO"></a>VSCO</h2><p>&#8195;&#8195;第一款介绍的是 VSCO，这款基本可以说是修图必备的人气 APP 了，软件的详细功能之类我不会讲，毕竟我不是在做 APP 推荐帖子；我们直接来看第一张图。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_41.jpg" alt="sy_41"></p>
<p>&#8195;&#8195;这种图我的第一反应是背景变白，那么就需要加曝光。基本思路就是加曝光，调一下对比度和色温让画面平衡一下，再弄个自己中意的颜色。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_42.jpg" alt="sy_42"></p>
<p>&#8195;&#8195;我们打开 VSCO，进入修图界面，首先选择一个滤镜（看个人喜好和对色彩的感觉），再点一次选中的滤镜，进行滤镜程度的调整；这里我选的是 A1、+10。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_43.jpg" alt="sy_43"></p>
<p>&#8195;&#8195;接下来按照软件的顺序，进行第二项调整，微调。首先是对比度和曝光的调整，两者协调一下，这张图我的目的是使背景变白，同时保持主体色彩不过度修。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_44.jpg" alt="sy_44"></p>
<p>&#8195;&#8195;然后是按照软件的顺序进行裁剪和色温的调整，这张图我们自然是裁剪为完完整整的正方形，同时让碗成为中心的一个圆，适当调整色温（个人喜好，取决于照片内容，调得偏冷 / 暖）；虽然我是按照软件排列顺序做的，但是我建议，首先进行裁剪，再对色彩、曝光、对比度等进行调整。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_45.jpg" alt="sy_45"></p>
<p>&#8195;&#8195;最后，因为个人觉得颜色不够艳，加一点饱和度，旋转是为了让筷子保持水平。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_46.jpg" alt="sy_46"></p>
<p>&#8195;&#8195;最后完成，保存图片，我们来看看最后的效果图吧。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_47.jpg" alt="sy_47"></p>
<p>&#8195;&#8195;接下来我们来看第二张图。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_48.jpg" alt="sy_48"></p>
<p>&#8195;&#8195;很明显，主体是人和窗户那里，其他地方呢？得全部去掉；另一方面图片的色彩并不好看，那怎么办？转为黑白。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_49.jpg" alt="sy_49"></p>
<p>&#8195;&#8195;同样的，首先选择色彩，这里我们需要选择B系列（黑白滤镜）。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_50.jpg" alt="sy_50"></p>
<p>&#8195;&#8195;然后进行裁剪，裁剪这张图我多讲一点，也就是关于后期的二次构图。基本点我已经用红线画出来了，可以看到，这里地面的位置我选择了三分线的位置，人物没有完全的位于黄金分割点，这里为了让上面部分对称且去掉右边红圈圈出来的杂物，这就是需要取舍的地方。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_51.jpg" alt="sy_51"></p>
<p>&#8195;&#8195;裁剪过后，调节曝光和对比度到一个合适的程度，注意这张图本来光线不好，过曝会使得画面出现大量噪点；另一方面我发现噪点基本是出现于边角，于是我们可以选择加暗角，使得边角的噪点消失。最后保存图片，同样的，我们来看下修改后图片。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_52.jpg" alt="sy_52"></p>
<p>&#8195;&#8195;下一张图，我讲一下夜景的修图。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_53.jpg" alt="sy_53"></p>
<p>&#8195;&#8195;夜景我想主要是噪点和色彩这两方面，处理噪点，同样的我们需要降低曝光值，色彩方面，调节对比度、色温、饱和度即可。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_54.jpg" alt="sy_54"></p>
<p>&#8195;&#8195;选择滤镜，降低曝光。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_55.jpg" alt="sy_55"></p>
<p>&#8195;&#8195;加对比度，裁剪，相信大家对这些已经比较熟悉了。这张图的色彩我认为已经够艳了，所以并没有调节饱和度；最后我们看一下修改后的图片。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_56.jpg" alt="sy_56"></p>
<p>&#8195;&#8195;最后介绍一个玩法，大家可能会比较好奇我拍的坚果手机的多彩背景（下图），接下来我就叫你如何用 VSCO 快速完成这种效果。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_57.jpg" alt="sy_57"></p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_58.jpg" alt="sy_58"></p>
<p>&#8195;&#8195;其实是十分简单了，真正的一键完成。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_59.jpg" alt="sy_59"></p>
<p>&#8195;&#8195;首先我们进入修图界面，选择最后一个图标，带 H 字母的那个，然后进入选择你喜欢的色彩即可。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_60.jpg" alt="sy_60"></p>
<p>&#8195;&#8195;对于图示这种效果，自然是需要图片背景是白色，主体却几乎没有白色或者浅色这种照片才可以的，大家可以看到，它其实是调节高光色调的。</p>
<p>&#8195;&#8195;<strong>最后说明几点：</strong></p>
<ul>
<li><p>1.修图这种东西，个人认为还是多看，去优秀的作品里培养对色彩的感觉，然后自己去慢慢形成一个自己的风格。</p>
</li>
<li><p>2.针对于每张图片，所微调的地方肯定不一样，所以建议不要去照搬什么调色教程里的参数，看那样的教程对于学习软件是可以的，照搬肯定不可行。</p>
</li>
<li><p>3.VSCO 这款软件的大部分滤镜需要购买，希望大家支持正版；不过我暂时未找到安卓版本方便的购买方法（现在似乎需要去 Google Play 购买，欢迎纠正），我自己是在 IOS 端购买的，然后账号同步到安卓版上面的。</p>
</li>
<li><p>4.这款软件的更多功能，有兴趣的朋友可以去尝试一下，例如相机和社区，还有修图方面的阴影、高光调节等等，大家多多尝试，自然知道它们是干什么的了。</p>
</li>
</ul>
<h2 id="Snapseed"><a href="#Snapseed" class="headerlink" title="Snapseed"></a>Snapseed</h2><p>&#8195;&#8195;这款软件相比 VSCO 更加专业，我主要使用它的几个功能，这次也主要是推荐这几个功能给大家。同样的，从图片说起。这张图片熟悉吧？没错，就是我们刚才用 VSCO 调整完的图片，那么它还有什么问题呢？</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_61.jpg" alt="sy_61"></p>
<p>&#8195;&#8195;仔细观察，因为镜头的缘故，画面边缘发生了变形，本应该直立的墙，却变斜了。这时候我们需要用到 Snapseed 的变形功能。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_62.jpg" alt="sy_62"></p>
<p>&#8195;&#8195;通过相应的调整后（这个具体操作大家去尝试就明白了），我这里给出最终图。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_63.jpg" alt="sy_63"></p>
<p>&#8195;&#8195;这里很不要脸的道歉一句：调整后的图片大家可以看到，墙是好了，但是水平线有点问题，这个需要在 Snapseed 里面再仔细的调整一下，时间缘故，我不再去调整了。请各位带着对我的宽恕，我们进入下一张。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_64.jpg" alt="sy_64"></p>
<p>&#8195;&#8195;这张图本身也是 VSCO 调整过色彩的图，我们可以看到，问题在于垃圾桶，图片摄于八达岭长城，这自然不能有垃圾桶啊；于是，我们的 Snapseed 的局部调整和修复就派上用场了。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_65.jpg" alt="sy_65"></p>
<p>&#8195;&#8195;选择局部，点左下角的加号，再在图片上面点一下，会出现一个蓝色圆圈，它可以移动，可以更改调整的内容，可以修改调整的范围，我们把它移动到垃圾桶上面，并把范围（出现红光区域）缩小，然后滑动调整（这个需要你们去用用 Snapseed ），使得局部变暗。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_66.jpg" alt="sy_66"></p>
<p>&#8195;&#8195;同样的手法，加入很多个蓝色圆圈进行调整，然后点完成，再进入（ Snapseed 是覆盖性的调整，这点不同于 VSCO ），再进行调整，直到足够黑为止；调到这里，我们仍然会看到有部分垃圾桶的影子，这时候我们就需要 Snapseed 的修复功能。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_67.jpg" alt="sy_67"></p>
<p>&#8195;&#8195;用修复功能，先把图片放大，再去小心的涂抹（它的原理是将你选择的地方抹去，用周围的图片来填充，这可以运用于去污点），直到慢慢的把所有的痕迹都涂抹掉。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_68.jpg" alt="sy_68"></p>
<p>&#8195;&#8195;最后，我们进入 Snapseed 的图片调整，进行暖色调和饱和度调整（VSCO 也能调整，但是程度没有 Snapseed 这么大，注意一下，我上图是先调整的右边，再调整的左边，对于这个错误，十分抱歉）。最后我们看看对比图。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_69.jpg" alt="sy_69"></p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_70.jpg" alt="sy_70"></p>
<p>&#8195;&#8195;最后介绍一个功能：细节；简单说一下就好，这次没有原图也没有对比图（不要打我）。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_71.jpg" alt="sy_71"></p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_72.jpg" alt="sy_72"></p>
<p>&#8195;&#8195;细节调整是用于上面这种类似图片，需要表现细节的时候可以尝试一下，在不毁掉图片的情况上，提升细节的观感。</p>
<p>&#8195;&#8195;<strong>最后说明几点：</strong></p>
<ul>
<li><p>1.Snapseed 提供了很多功能，它的自带滤镜我点过几次，个人认为惨不忍睹，所以也不建议你们去使用。</p>
</li>
<li><p>2.我这次介绍的几个功能是我认为比较不错的，希望大家去尝试一下。</p>
</li>
<li><p>3.出于被谷歌收购的原因，这款优秀的软件完全免费。</p>
</li>
</ul>
<h2 id="Layout"><a href="#Layout" class="headerlink" title="Layout"></a>Layout</h2><p>&#8195;&#8195;怎么描述这款软件呢？简单好用的拼图软件。大家可以利用它，多多创造好玩的照片哦；我这里给两个示范，希望可以给大家一点灵感。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_73.jpg" alt="sy_73"></p>
<p>&#8195;&#8195;进入软件，操作非常简单，选择你想要拼的图片，再选择你想要的布局，然后自动进入下一步。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_74.jpg" alt="sy_74"></p>
<p>&#8195;&#8195;对图片进行翻转和镜像的调整，做出你想要的感觉。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_75.jpg" alt="sy_75"></p>
<p>&#8195;&#8195;一张照片可以拼，多张自然也可以的。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_76.jpg" alt="sy_76"></p>
<p>&#8195;&#8195;调整好图片位置，然后保存，分享；还是给各位看看最后的效果图吧。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_77.jpg" alt="sy_77"></p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_78.jpg" alt="sy_78"></p>
<p>&#8195;&#8195;这款软件同样也是免费的，并且十分的简单易用。</p>
<h2 id="图片合成器"><a href="#图片合成器" class="headerlink" title="图片合成器"></a>图片合成器</h2><p>&#8195;&#8195;它来自国内，我这样说是要告诉你，虽然它可以实现双重曝光这个效果，但是界面花哨、插件多、广告也有，体验并不是很好，不过好在我们若是不管其他的，只用基础功能来做双重曝光，它这些就不影响我们。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_79.jpg" alt="sy_79"></p>
<p>&#8195;&#8195;首先进入软件，选择经典合成，然后选择照片。双重曝光最重要的还是对照片的选择，左边的照片需要选择图示这种，干净背景的照片；右边的照片，要求并不是很高，看个人喜好，可以是楼房、花海等等；选好后我们进入下一步。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_80.jpg" alt="sy_80"></p>
<p>&#8195;&#8195;在下方列表选择滤镜和效果，上面调整一下画面，然后就可以保存分享啦，操作还是很简单的；给大家看一看效果图。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_81.jpg" alt="sy_81"></p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>&#8195;&#8195;终于把这最后一篇完成了。如果大家觉得还可以，请点个喜欢或关注，多谢大家。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.leoyanblog.com/post/2017/03/15.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Leo Yan">
      <meta itemprop="description" content="离经不叛道，特立不独行。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeoYan Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/post/2017/03/15.html" class="post-title-link" itemprop="url">关于手机摄影的几点建议（三）光与弱光</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-03-15 10:00:00" itemprop="dateCreated datePublished" datetime="2017-03-15T10:00:00+08:00">2017-03-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2017-03-27 11:52:34" itemprop="dateModified" datetime="2017-03-27T11:52:34+08:00">2017-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%91%84%E5%BD%B1/" itemprop="url" rel="index"><span itemprop="name">摄影</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%91%84%E5%BD%B1/%E6%89%8B%E6%9C%BA%E6%91%84%E5%BD%B1/" itemprop="url" rel="index"><span itemprop="name">手机摄影</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>转载请注明出处：<a href="http://www.leoyanblog.com">www.leoyanblog.com</a></p>
<p>本文出自 LeoYan 的博客</p>
<p>本文同步发表于我的微信公众号，扫一扫文章底部的二维码或在微信搜索 LeoYan 即可关注。</p>
</blockquote>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_27_1.jpg" alt="sy_27_1"></p>
<h2 id="相关文章"><a href="#相关文章" class="headerlink" title="相关文章"></a>相关文章</h2><p><a href="http://www.leoyanblog.com/post/2017/03/13.html">关于手机摄影的几点建议（一）从零开始</a></p>
<p><a href="http://www.leoyanblog.com/post/2017/03/14.html">关于手机摄影的几点建议（二）如何构图</a></p>
<p><a href="http://www.leoyanblog.com/post/2017/03/16.html">关于手机摄影的几点建议（四）后期修图</a></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>&#8195;&#8195;这一期我主要讲两个事情，一是「多利用光线」，二是「弱光能拍什么」；下面我们直入正题。</p>
<h2 id="天气好就该去拍照"><a href="#天气好就该去拍照" class="headerlink" title="天气好就该去拍照"></a>天气好就该去拍照</h2><p>&#8195;&#8195;看到外面阳光明媚，特别是现在处于冬天，好不容易的好天气，我们自然是想出去玩啦，要是有仍然想待在家里的朋友，那为了拍更好的照片，你也应该出去走走呢。总之，别总待在家里。</p>
<p>&#8195;&#8195;相信大家都很容易发现，天气好的情况下，我们用手机拍的照片，画质会好很多，这便是光给我们的好处，所以各位，一定不要放过天气好的日子。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_28.jpg" alt="sy_28"></p>
<p>&#8195;&#8195;这次的示例照片没有很多，主要是其实「用光」这一点，也是我的弱点。出于一开始养成了习惯，很随意的拍，没有太在意光这方面，我现在是后悔了，所以才来建议大家要重视这个。</p>
<p>&#8195;&#8195;当然，天气好的时候，也有分适合拍照的时候，这便是人们常常讲的「摄影黄金时间」；摄影黄金时间是日出后的一小时与日落前的一小时左右，此时太阳位置较低，在太阳低角度的照射下，柔和光线使景物产生较长的阴影，使得画面更加精彩。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_29.jpg" alt="sy_29"></p>
<p>&#8195;&#8195;当然，这个黄金时间，基本也是我们正在睡觉/吃晚饭的时间，所以要拍好照片，也不是那么容易的。示例图片也离黄金时间差了一点，出于版权的问题我没有给大家上网找类似图片，关于对光线运用的照片示例，我建议大家去看看刘辰的作品，在第一期的网站推荐中，LOFTER里可以看到他的照片，他的主页地址是：<a href="http://coculiu.lofter.com/" target="_blank" rel="noopener">http://coculiu.lofter.com/</a></p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_30.jpg" alt="sy_30"></p>
<p>&#8195;&#8195;这是题图的照片，老实讲，这是我为这期帖子前几天专程去照的。是的，我的习惯已经坏了点，对光线不敏感，最近我在尽力改善这点。我希望大家可别学我，一定要对光线敏感。</p>
<p>&#8195;&#8195;如我前面所说，光线带给我们的，不仅仅是更好的画质，还有我们平时所未在意的景和物。</p>
<p>&#8195;&#8195;最后对于光的建议是，如果不是照片需要，尽可能的顺光拍，而不是逆光拍。但是逆光拍可以产生剪影的效果，具体效果大家可以看接下来夜间的图。</p>
<h2 id="光线差也别放弃照"><a href="#光线差也别放弃照" class="headerlink" title="光线差也别放弃照"></a>光线差也别放弃照</h2><p>&#8195;&#8195;光线好的时候应该多照，那么光线差的时候呢？特别是夜间，大家想拍夜景，却又觉得我们的 Smartisan T1 夜间成像不够好，就放弃了。难道用手机就不能拍夜景了吗？当然不是的。接下来我将讲一些我对于手机摄影面对光线差以及夜间的看法。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_31.jpg" alt="sy_31"></p>
<p>&#8195;&#8195;非夜间光线差的情况我只讲这一张图。这是摄于上海当代艺术博物馆内，四周几乎无窗，大家可以看到这张图的画质是比较差的，而且我还几乎裁剪了一半。但是这张照片的内容很不错，情侣坐在一起看电影。所以我要说的是：1.摄影是为了记录，在内容好的情况下，我们就别太在意画质；2.在色彩适合转黑白的情况下，转黑白也许可以弥补画质的不足。关于后期的事情，下一期我会着重讲。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_32.jpg" alt="sy_32"></p>
<p>&#8195;&#8195;接下来开始说夜间照相。当然，第一步是把我们相机里的「夜间模式」打开，相信这个大家都会。需要注意的是，Smartisan OS的夜间模式是连续拍几张照片然后合成进行降噪处理，所以我们在拍照的时候，尽可能的保持手稳，直到照片拍完。上图即为用「夜间模式」拍的照片，这照片我另外想说的是，手机的夜景大家其实都清楚是怎么回事，所以不要太在意细节，我们把握整体的感觉，比如上图的整体颜色就让人看起感觉还不错。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_33.jpg" alt="sy_33"></p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_34.jpg" alt="sy_34"></p>
<p>&#8195;&#8195;夜间还能拍什么？拍光，对着光拍。图一呢即是前文所提到的逆光拍产生剪影的效果，白天当然也可以逆光拍产生这种效果，只要运用于恰当的地方即可。对着光拍我们可以看到，光的部分可以完整的拍下来，至于其他部分呢，我们通过后期调色处理为纯黑色，做到一个留白（还是留黑呢？）的效果。</p>
<p>&#8195;&#8195;还有一点，这里的光，我指的是夜间你所能看到的，灯光、火光等等。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_35.jpg" alt="sy_35"></p>
<p>&#8195;&#8195;有些时候对着光拍，但是周遭的色彩并不是很有特色甚至显得杂乱的时候，我们可以选择转为黑白色。一方面画质看起来更好了，另一方面画面也变得简单起来。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_36.jpg" alt="sy_36"></p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_37.jpg" alt="sy_37"></p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_38.jpg" alt="sy_38"></p>
<p>&#8195;&#8195;这三张图相信大家可以看出共同点，即失焦。</p>
<p>&#8195;&#8195;它的优点我想是显而易见的，一是画质对它影响不大，二是好看。接下来我教大家如何用T1拍出这样的照片。</p>
<p>&#8195;&#8195;【此处更新，发现Smartisan OS相机支持长按锁焦功能，所以拍失焦照片更加简单，感谢论坛朋友skyoss提醒】</p>
<p>&#8195;&#8195;1.对近处进行长按对焦，也可以是对自己的左手长按对焦（如果你用右手拍照），锁焦成功后系统会有提示</p>
<p>&#8195;&#8195;2.对准你想拍的地方拍照即可，然后进行后期处理</p>
<p>&#8195;&#8195;3.进行此拍照时候可打开夜间模式</p>
<p>&#8195;&#8195;希望大家都能拍出这种风格的照片。在有些场景下，我相信它除了好看之外，还是会有其他意义的，比如梦幻的一种感觉。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_39.jpg" alt="sy_39"></p>
<p>&#8195;&#8195;这张图是年初拍的了，大家看到的这台手机是老去的Nokia Lumia920，我给这张照片想说的是，在背景灯光漂亮的情况下，对近处的物/人进行拍照，也会有不错的效果哦，兴许可以用这样去拍女朋友哦，不过我没有尝试过，大家可以试看。</p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>&#8195;&#8195;这一期的分享就到此结束了。</p>
<p>&#8195;&#8195;至此，我简单的说了对于手机摄影的理解，从最基础的准备，到最重要的构图，以及今天进阶的用光。我的观点始终是内容第一，画质第二；马上这一系列建议也将迎来最后一篇了，即后期篇。但是请大家明白，需要后期的照片，一定是值得后期的照片，而这一切，需要靠前期的内容和构图。</p>
<p>&#8195;&#8195;如果大家觉得还可以，请点个喜欢或关注，多谢大家。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.leoyanblog.com/post/2017/03/14.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Leo Yan">
      <meta itemprop="description" content="离经不叛道，特立不独行。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeoYan Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/post/2017/03/14.html" class="post-title-link" itemprop="url">关于手机摄影的几点建议（二）如何构图</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-03-14 10:00:00" itemprop="dateCreated datePublished" datetime="2017-03-14T10:00:00+08:00">2017-03-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2017-05-17 16:12:57" itemprop="dateModified" datetime="2017-05-17T16:12:57+08:00">2017-05-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%91%84%E5%BD%B1/" itemprop="url" rel="index"><span itemprop="name">摄影</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%91%84%E5%BD%B1/%E6%89%8B%E6%9C%BA%E6%91%84%E5%BD%B1/" itemprop="url" rel="index"><span itemprop="name">手机摄影</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>转载请注明出处：<a href="http://www.leoyanblog.com">www.leoyanblog.com</a></p>
<p>本文出自 LeoYan 的博客</p>
<p>本文同步发表于我的微信公众号，扫一扫文章底部的二维码或在微信搜索 LeoYan 即可关注。</p>
</blockquote>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_14_1.jpg" alt="sy_14_1"></p>
<h2 id="相关文章"><a href="#相关文章" class="headerlink" title="相关文章"></a>相关文章</h2><p><a href="http://www.leoyanblog.com/post/2017/03/13.html">关于手机摄影的几点建议（一）从零开始</a></p>
<p><a href="http://www.leoyanblog.com/post/2017/03/15.html">关于手机摄影的几点建议（三）光与弱光</a></p>
<p><a href="http://www.leoyanblog.com/post/2017/03/16.html">关于手机摄影的几点建议（四）后期修图</a></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>&#8195;&#8195;上一期我主要讲了一些开始「手机摄影」需要养成的习惯，以及一些从无到有的学习建议，即准备、构图、后期、练习和多看。</p>
<p>&#8195;&#8195;那么这一期主要是对构图展开来讲，可能没有你所期望的各种构图的介绍，我主要以一年来用 Smartisan T1 所摄的照片为例，讲一下我对构图的理解。</p>
<h2 id="怎样构图"><a href="#怎样构图" class="headerlink" title="怎样构图"></a>怎样构图</h2><p>&#8195;&#8195;到底要怎样构图？我总觉得这不该有一套完整的体系，它应该是随性的，是自由的；能让一张照片表达出该有的感情的，就是好的构图。</p>
<p>&#8195;&#8195;网上有不少关于各类构图的介绍，诸如「三分法」、「黄金分割」、「对角线」等等，有兴趣的朋友可以去网上搜一下，大同小异的讲法，但是我觉得那些只看一看就好，甚至，看都别看。</p>
<p>&#8195;&#8195;构图，是一种感觉；构图的功力，就像炒菜对火候把握的功力一样。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_15.jpg" alt="sy_15"></p>
<p>&#8195;&#8195;我们先看第一张图，正方形比例裁剪，月亮放在画面中间，右侧的树枝，左侧的留白，天的蓝色，这一切都恰到好处；所以我们构图是为了什么？为了把本来的美更好的展现出来。</p>
<p>&#8195;&#8195;这里给出本篇贴的第一个建议：画面元素尽可能的少；可以看到，本图一共三种颜色，月亮、树枝、天空，这样就够了。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_16.jpg" alt="sy_16"></p>
<p>&#8195;&#8195;同样的，简单的元素，人物的位置大家可以看到，大概是位于「黄金分割点」的，个人认为，「黄金分割点」的目的是让画面主体看起来平衡。</p>
<p>&#8195;&#8195;这张图并没有用正方形裁剪，但是结合一二两图我对「正方形构图」说一下，个人建议是：1.尝试去用，但不是每张图都适用；2.社交网络分享的时候（新浪微博、朋友圈等），多图分享的小图排版时候会自动展示正方形裁剪后的图片，既然如此，我建议是网络多图分享时，都裁剪为正方形，避免系统自动裁剪使得照片不好看。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_17.jpg" alt="sy_17"></p>
<p>&#8195;&#8195;说复杂点，这可能就是所谓的「三分法」，画面主体位于图片的三分之一处，但是我们平时生活所见，不也应该是这样子吗？所以，构图是件很自然的事情，源于对生活的观察。</p>
<p>&#8195;&#8195;当然，画面的倒影、放风筝的人、风筝，这些元素，都是需要你的观察，以及你的构图，将其带入画面中。</p>
<blockquote>
<p>注：这张照片是iPhone5S拍摄的，并非T1，因为当时两个手机都在身边，现在只用T1了，久了我给弄混了，十分抱歉</p>
</blockquote>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_18.jpg" alt="sy_18"></p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_19.jpg" alt="sy_19"></p>
<p>&#8195;&#8195;这两张图放在一起，我想讲的是「留白」，第二张图片可能更能体现这个主体。请记住：留白是一种美。</p>
<p>&#8195;&#8195;第二张图在构图上还有一点，首先主体有点类似四分之一圆，那么它处的位置，也基本上占据了画面的四分之一；你问这有什么意义呢？我答不上来，但是我总是感觉，这样子它更耐看一些，或许是「几何美」。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_20.jpg" alt="sy_20"></p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_21.jpg" alt="sy_21"></p>
<p>&#8195;&#8195;看到这两张图，很明显的一个感受是什么？纵深。</p>
<p>&#8195;&#8195;怎样拍出纵深感的照片呢？去发现、多尝试，构图则体现在尝试这里，我们发现一个有纵深感的地方，怎么拍？站着拍、蹲着拍、趴着怕、侧面拍、正面拍，在一个地方多次尝试，最后慢慢筛选，总有想要的。</p>
<p>&#8195;&#8195;同样，对第二张图做一点补充；我朋友看见这张图的第一反应是，要是没有那个穿红衣服的人就好了，而我的反应是，红衣服的人物是点睛之笔。这可能是每个人的看法不同了，于我这里，我认为红衣人倚靠在远处，以他的孤独加强了图片的纵深感，或者说，图片的纵深感加强了他的孤独，这样有所意义的画面不是更好？</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_22.jpg" alt="sy_22"></p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_23.jpg" alt="sy_23"></p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_24.jpg" alt="sy_24"></p>
<p>&#8195;&#8195;这三张图我们看到的又是什么呢？对称。</p>
<p>&#8195;&#8195;对于对称，我能想到的还是观察，对生活周边的观察，对你所想照的景的观察到位了，比如在上面三张图的情况下，去尝试对称构图，是自然而然的事情。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_25.jpg" alt="sy_25"></p>
<p>&#8195;&#8195;再谈自然而然。</p>
<p>&#8195;&#8195;这张图我认为自然而然的会把酒瓶放在构图的中央，并且采用正方形裁剪，我如此强调自然而然的原因是希望你们明白，构图是一种需要培养的感觉。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_26.jpg" alt="sy_26"></p>
<p>&#8195;&#8195;这张是典型的把主体（人）放在了「黄金分割点」上面，我其实用这样的构图特别多，因为实用，还是之前说的，让画面看起来平衡，这也是我为什么会给你们在第一篇帖子里介绍它的原因。</p>
<p>&#8195;&#8195;这张图还有一个比较好的地方是，水与岸边碎石所成的分界线，一定程度上产生了「几何美」，这是我今天第二次提到几何美了，也希望大家平时可以尝试多关注一下这方面的东西，有时候的确是很美的。</p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>&#8195;&#8195;很快很快，这一次的摄影建议也马上结束了，基本比较值得讲的照片我都说了一下我的想法（除了有些照片留在后面的建议「弱光下拍什么」来讲以外），希望大家都有所收获。</p>
<p>&#8195;&#8195;如果大家觉得还可以，请点个喜欢或关注，多谢大家。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.leoyanblog.com/post/2017/03/13.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Leo Yan">
      <meta itemprop="description" content="离经不叛道，特立不独行。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeoYan Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/post/2017/03/13.html" class="post-title-link" itemprop="url">关于手机摄影的几点建议（一）从零开始</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-03-13 10:00:00" itemprop="dateCreated datePublished" datetime="2017-03-13T10:00:00+08:00">2017-03-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2017-03-27 11:51:40" itemprop="dateModified" datetime="2017-03-27T11:51:40+08:00">2017-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%91%84%E5%BD%B1/" itemprop="url" rel="index"><span itemprop="name">摄影</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%91%84%E5%BD%B1/%E6%89%8B%E6%9C%BA%E6%91%84%E5%BD%B1/" itemprop="url" rel="index"><span itemprop="name">手机摄影</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>转载请注明出处：<a href="http://www.leoyanblog.com">www.leoyanblog.com</a></p>
<p>本文出自 LeoYan 的博客</p>
<p>本文同步发表于我的微信公众号，扫一扫文章底部的二维码或在微信搜索 LeoYan 即可关注。</p>
</blockquote>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_01_1.jpg" alt="sy_01_1"></p>
<h2 id="相关文章"><a href="#相关文章" class="headerlink" title="相关文章"></a>相关文章</h2><p><a href="http://www.leoyanblog.com/post/2017/03/14.html">关于手机摄影的几点建议（二）如何构图</a></p>
<p><a href="http://www.leoyanblog.com/post/2017/03/15.html">关于手机摄影的几点建议（三）光与弱光</a></p>
<p><a href="http://www.leoyanblog.com/post/2017/03/16.html">关于手机摄影的几点建议（四）后期修图</a></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>&#8195;&#8195;本文中用到的手机为 Smartisan T1，但目前大多数手机都会有类似的功能，所以不仅限于 Smartisan OS 的手机。</p>
<h2 id="手机的自带相机"><a href="#手机的自带相机" class="headerlink" title="手机的自带相机"></a>手机的自带相机</h2><p><img src="http://oddu03if7.bkt.clouddn.com/sy_02.jpg" alt="sy_02"></p>
<p>&#8195;&#8195;大家可以看到，这是我们 Smartisan OS 的相机界面，有一点不同的是，我这个界面有九宫格线，我的第一个建议便是大家首先应该养成一个习惯：把相机的九宫格线先打开。</p>
<p>&#8195;&#8195;具体方法即点击相机上方的设置图标，再点击下图所示位置即可。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_03.jpg" alt="sy_03"></p>
<p>&#8195;&#8195;你可能会问，这个打开是为了什么？我最开始使用相机的时候也不喜欢这个线，总觉得挡着我的视线；但是，现在我离不开它了，因为它是我们拍好一张照片的第一步：为了更好的构图。有关构图的，我们留到后面再讲。</p>
<p>&#8195;&#8195;第二个建议是，夜晚拍照的时候打开夜景模式，打开方式类似于打开九宫格，但是夜景模式的图标为「月亮」。</p>
<p>&#8195;&#8195;至于其他几个功能，如全景模式、HDR模式，本文不打算提及，有兴趣的朋友可以自己去尝试一下。</p>
<p>&#8195;&#8195;另外关于自带相机应用我想提醒大家的一个小功能是：两侧的按键，亮度键的控制曝光，音量键的则为快门按钮。</p>
<h2 id="关于内建修图功能"><a href="#关于内建修图功能" class="headerlink" title="关于内建修图功能"></a>关于内建修图功能</h2><p>&#8195;&#8195;相信大家都知道我们的Smartisan OS的相册软件中内建一个修图功能，但是我想大多数人很少去使用它。对于它，我想说的是：简单、轻便、快捷。所以我的建议是，对于一些简单的修图，完全可以尝试用内建修图功能去完成。接下来我以一张图片为例来介绍一下这个内建修图。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_04.jpg" alt="sy_04"></p>
<p>&#8195;&#8195;如图点击箭头所指图标，进入内建修图功能。</p>
<p>&#8195;&#8195;然后我们可以看到，里面总共有四个选项，分别是色彩、水平调整、裁剪、图画，这里我们主要介绍前三个，第四个功能大家可以看到，我演示所打的红色剪头，一部分就是第四个功能所完成的，但是它和我们今天所谈的摄影建议没有什么关系。</p>
<p>&#8195;&#8195;首先我们选择所想要的颜色风格</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_05.jpg" alt="sy_05"></p>
<p>&#8195;&#8195;之后是水平调整，这张图大家可能看不出什么区别，但是对于海边之类的照片，差别一看便知，后面我也会谈到这个</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_06.jpg" alt="sy_06"></p>
<p>&#8195;&#8195;最后，裁剪大小，我的建议是多尝试正方形比例，以除去不必要的画面</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_07.jpg" alt="sy_07"></p>
<p>&#8195;&#8195;最后点击完成（Done）</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_08.jpg" alt="sy_08"></p>
<p>&#8195;&#8195;相信大家对于内建修图功能已经有一定的了解了，这里我给的建议是：单纯的水平调整、图片裁剪，可以选择用内建修图功能来完成。</p>
<h2 id="推荐摄影APP"><a href="#推荐摄影APP" class="headerlink" title="推荐摄影APP"></a>推荐摄影APP</h2><p>&#8195;&#8195;对于更多的功能和风格需求，我们自然需要去寻找合适的第三方摄影APP。这里我推荐几个我常用的APP，后续的建议里我也讲一一进行详细介绍。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_09.jpg" alt="sy_09"></p>
<p>&#8195;&#8195;以下是由这四个软件编辑的照片</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_10.jpg" alt="sy_10"></p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_11.jpg" alt="sy_11"></p>
<h2 id="三个构图建议"><a href="#三个构图建议" class="headerlink" title="三个构图建议"></a>三个构图建议</h2><p>&#8195;&#8195;构图有太多种，我在这里只介绍三个，并不是说这三个最重要，只是在我个人平时的使用来看，这三个比较实用，且在大多数图片上面是不可丢失的构图要求。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_12.jpg" alt="sy_12"></p>
<p>&#8195;&#8195;虽然说三点，但是我们就在这一张图上面说。</p>
<p>&#8195;&#8195;第一个建议，「黄金构图点」，其实也没有那么高大上啦，说实话我至今也不是很熟悉「黄金分割」，但是简化的情况下，如上图的四个红点，即为「黄金构图点」，我们在拍照时，可以尝试把主体放在那四个点的其中一点上，这样一来，便符合人们视觉习惯，使得照片看起来比较好看。</p>
<p>&#8195;&#8195;第二个建议，地平线原则，在大多数的拍照过程中，我建议大家都根据九宫格所提供的水平线比一比，使得画面不倾斜，无论是地面、海、还是楼房等等，「大多数」情况下，都建议遵循这个地平线原则。</p>
<p>&#8195;&#8195;第三个建议，多尝试正方形比例的构图，这个建议在后期裁剪来做，目的是让构图看起来更着重点。</p>
<h2 id="网站推荐"><a href="#网站推荐" class="headerlink" title="网站推荐"></a>网站推荐</h2><p>&#8195;&#8195;最后一个建议，但是也是最重要的一个建议：多看、多拍。</p>
<p>&#8195;&#8195;对于多拍，自然是要大家自己平时走到哪儿就拍到哪儿，尽可能的多练习。</p>
<p>&#8195;&#8195;这里我对于「多看」推荐几个优秀的网站供大家参考，其中包括摄影网站、设计网站等，之所以有非摄影网站，我是建议大家什么都看，只要是优秀的，电影、音乐、设计作品都有益的。</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/sy_13.jpg" alt="sy_13"></p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>&#8195;&#8195;简单的几个小建议，希望对大家有用。</p>
<p>&#8195;&#8195;如果大家觉得还可以，请点个喜欢或关注，多谢大家。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.leoyanblog.com/post/2017/03/12.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Leo Yan">
      <meta itemprop="description" content="离经不叛道，特立不独行。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeoYan Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/post/2017/03/12.html" class="post-title-link" itemprop="url">Android 之 BroadcastReceiver (二) 常见的系统广播</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-03-12 10:00:00" itemprop="dateCreated datePublished" datetime="2017-03-12T10:00:00+08:00">2017-03-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2017-03-27 11:51:15" itemprop="dateModified" datetime="2017-03-27T11:51:15+08:00">2017-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">四大组件</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6/BroadcastReceiver/" itemprop="url" rel="index"><span itemprop="name">BroadcastReceiver</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>转载请注明出处：<a href="http://www.leoyanblog.com">www.leoyanblog.com</a></p>
<p>本文出自 LeoYan 的博客</p>
<p>本文同步发表于我的微信公众号，扫一扫文章底部的二维码或在微信搜索 LeoYan 即可关注。</p>
</blockquote>
<h2 id="常见的几个系统广播"><a href="#常见的几个系统广播" class="headerlink" title="常见的几个系统广播"></a>常见的几个系统广播</h2><h3 id="系统启动完成"><a href="#系统启动完成" class="headerlink" title="系统启动完成"></a>系统启动完成</h3><p>&#8195;&#8195;我们经常会有这样的应用场合，比如消息推送服务，需要实现开机启动的功能。要实现这个功能，我们就可以订阅系统“启动完成”这条广播，接收到这条广播后我们就可以启动自己的服务了。我们来看一下BootCompleteReceiver和MsgPushService的具体实现：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">BootCompleteReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> static <span class="keyword">final</span> <span class="type">String</span> <span class="type">TAG</span> = <span class="string">"BootCompleteReceiver"</span>;  </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    public void onReceive(<span class="type">Context</span> context, <span class="type">Intent</span> intent) &#123;  </span><br><span class="line">        <span class="type">Intent</span> service = <span class="keyword">new</span> <span class="type">Intent</span>(context, <span class="type">MsgPushService</span><span class="class">.<span class="keyword">class</span>)</span>;  </span><br><span class="line">        context.startService(service);  </span><br><span class="line">        <span class="type">Log</span>.i(<span class="type">TAG</span>, <span class="string">"Boot Complete. Starting MsgPushService..."</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MsgPushService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"MsgPushService"</span>;  </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">super</span>.onCreate();  </span><br><span class="line">        Log.i(TAG, <span class="string">"onCreate called."</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;  </span><br><span class="line">        Log.i(TAG, <span class="string">"onStartCommand called."</span>);  </span><br><span class="line">        <span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">onStartCommand</span><span class="params">(intent, flags, startId)</span></span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="function">IBinder <span class="title">onBind</span><span class="params">(Intent arg0)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&#8195;&#8195;然后我们需要在 AndroidManifest.xml 中配置相关信息：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 开机广播接受者 --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">".BootCompleteReceiver"</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line">        <span class="comment">&lt;!-- 注册开机广播地址--&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.BOOT_COMPLETED"</span>/&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span>  </span><br><span class="line"><span class="comment">&lt;!-- 消息推送服务 --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">service</span> <span class="attr">android:name</span>=<span class="string">".MsgPushService"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>&#8195;&#8195;我们看到 BootCompleteReceiver 注册了 “android.intent.action.BOOT_COMPLETED” 这个开机广播地址，从安全角度考虑，系统要求必须声明接收开机启动广播的权限，于是我们再声明使用下面的权限：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:<span class="built_in">name</span>=<span class="string">"android.permission.RECEIVE_BOOT_COMPLETED"</span> /&gt;</span><br></pre></td></tr></table></figure>

<h3 id="网络状态"><a href="#网络状态" class="headerlink" title="网络状态"></a>网络状态</h3><p>&#8195;&#8195;在某些场合，比如用户浏览网络信息时，网络突然断开，我们要及时地提醒用户网络已断开。要实现这个功能，我们可以接收网络状态改变这样一条广播，当由连接状态变为断开状态时，系统就会发送一条广播，我们接收到之后，再通过网络的状态做出相应的操作。下面就来实现一下这个功能：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NetworkStateReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"NetworkStateReceiver"</span>;   </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;  </span><br><span class="line">        Log.i(TAG, <span class="string">"network state changed."</span>);  </span><br><span class="line">        <span class="keyword">if</span> (!isNetworkAvailable(context)) &#123;  </span><br><span class="line">            Toast.makeText(context, <span class="string">"network disconnected!"</span>, <span class="number">0</span>).show();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 网络是否可用 </span></span><br><span class="line"><span class="comment">     *  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isNetworkAvailable</span><span class="params">(Context context)</span> </span>&#123;  </span><br><span class="line">        ConnectivityManager mgr = (ConnectivityManager) context.getSystemService(Context.CONNECTIVITY_SERVICE);  </span><br><span class="line">        NetworkInfo[] info = mgr.getAllNetworkInfo();  </span><br><span class="line">        <span class="keyword">if</span> (info != <span class="keyword">null</span>) &#123;  </span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; info.length; i++) &#123;  </span><br><span class="line">                <span class="keyword">if</span> (info[i].getState() == NetworkInfo.State.CONNECTED) &#123;  </span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&#8195;&#8195;然后我们需要在 AndroidManifest.xml 中再注册一下这个广播接收者的信息：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">".NetworkStateReceiver"</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.net.conn.CONNECTIVITY_CHANGE"</span>/&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&#8195;&#8195;因为在 isNetworkAvailable 方法中我们使用到了网络状态相关的 API，所以需要声明相关的权限才行，下面就是对应的权限声明：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:<span class="attribute">name</span>=<span class="string">"android.permission.ACCESS_NETWORK_STATE"</span>/&gt;</span><br></pre></td></tr></table></figure>

<h3 id="电量变化"><a href="#电量变化" class="headerlink" title="电量变化"></a>电量变化</h3><p>&#8195;&#8195;如果我们阅读软件，可能是全屏阅读，这个时候用户就看不到剩余的电量，我们就可以为他们提供电量的信息。要想做到这一点，我们需要接收一条电量变化的广播，然后获取百分比信息，这听上去挺简单的，我们就来实现以下：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">BatteryChangedReceiver</span> <span class="symbol">extends</span> <span class="symbol">BroadcastReceiver</span> &#123;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> static <span class="keyword">final</span> String TAG = <span class="string">"BatteryChangedReceiver"</span>;  </span><br><span class="line">    </span><br><span class="line">    @Override  </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> onReceive(Context context, Intent <span class="built_in">int</span>ent) &#123;  </span><br><span class="line">        <span class="comment">// 当前电量  </span></span><br><span class="line">        <span class="built_in">int</span> currLevel = <span class="built_in">int</span>ent.getIntExtra(BatteryManager.EXTRA_LEVEL, <span class="number">0</span>); </span><br><span class="line">        <span class="comment">// 总电量  </span></span><br><span class="line">        <span class="built_in">int</span> total = <span class="built_in">int</span>ent.getIntExtra(BatteryManager.EXTRA_SCALE, <span class="number">1</span>); </span><br><span class="line">        <span class="built_in">int</span> percent = currLevel * <span class="number">100</span> / total;  </span><br><span class="line">        Log.i(TAG, <span class="string">"battery: "</span> + percent + <span class="string">"%"</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&#8195;&#8195;然后我们需要在 AndroidManifest.xml 中再注册一下这个广播接收者的信息：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">".BatteryChangedReceiver"</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.BATTERY_CHANGED"</span>/&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&#8195;&#8195;当然，有些时候我们是要立即获取电量的，而不是等电量变化的广播，比如当阅读软件打开时立即显示出电池电量。我们可以按以下方式获取：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Intent batteryIntent = get<span class="constructor">ApplicationContext()</span>.register<span class="constructor">Receiver(<span class="params">null</span>, <span class="params">new</span> IntentFilter(Intent.ACTION_BATTERY_CHANGED)</span>);  </span><br><span class="line"><span class="built_in">int</span> currLevel = batteryIntent.get<span class="constructor">IntExtra(BatteryManager.EXTRA_LEVEL, 0)</span>;  </span><br><span class="line"><span class="built_in">int</span> total = batteryIntent.get<span class="constructor">IntExtra(BatteryManager.EXTRA_SCALE, 1)</span>;  </span><br><span class="line"><span class="built_in">int</span> percent = currLevel<span class="operator"> * </span><span class="number">100</span><span class="operator"> / </span>total;  </span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(<span class="string">"battery"</span>, <span class="string">"battery: "</span> + percent + <span class="string">"%"</span>);</span><br></pre></td></tr></table></figure>

<h3 id="监听SD卡状态"><a href="#监听SD卡状态" class="headerlink" title="监听SD卡状态"></a>监听SD卡状态</h3><p>&#8195;&#8195;清单文件中定义广播接收者接收的类型，监听SD卡常见的三种状态，所以广播接收者需要接收三种广播</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">"com.leoyanblog.sdcradlistener.SDCardReceiver"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MEDIA_MOUNTED"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MEDIA_UNMOUNTED"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MEDIA_REMOVED"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"file"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&#8195;&#8195;广播接收者的定义</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">SDCardReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    public void onReceive(<span class="type">Context</span> context, <span class="type">Intent</span> intent) &#123;</span><br><span class="line">        <span class="comment">// 区分接收到的是哪个广播</span></span><br><span class="line">        <span class="type">String</span> action = intent.getAction();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(action.equals(<span class="string">"android.intent.action.MEDIA_MOUNTED"</span>))&#123;</span><br><span class="line">            <span class="type">System</span>.out.println(<span class="string">"sd卡就绪"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(action.equals(<span class="string">"android.intent.action.MEDIA_UNMOUNTED"</span>))&#123;</span><br><span class="line">            <span class="type">System</span>.out.println(<span class="string">"sd卡被移除"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(action.equals(<span class="string">"android.intent.action.MEDIA_REMOVED"</span>))&#123;</span><br><span class="line">            <span class="type">System</span>.out.println(<span class="string">"sd卡被拔出"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="监听应用的安装、卸载、更新"><a href="#监听应用的安装、卸载、更新" class="headerlink" title="监听应用的安装、卸载、更新"></a>监听应用的安装、卸载、更新</h3><p>&#8195;&#8195;应用在安装卸载更新时，系统会发送广播，广播里会携带应用的包名，清单文件定义广播接收者接收的类型，因为要监听应用的三个动作，所以需要接收三种广播</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">"com.leoyanblog.app.AppReceiver"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.PACKAGE_ADDED"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.PACKAGE_REPLACED"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.PACKAGE_REMOVED"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"package"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&#8195;&#8195;广播接收者的定义</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">AppReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    public void onReceive(<span class="type">Context</span> context, <span class="type">Intent</span> intent) &#123;</span><br><span class="line">        <span class="comment">//区分接收到的是哪种广播</span></span><br><span class="line">        <span class="type">String</span> action = intent.getAction();</span><br><span class="line">        <span class="comment">//获取广播中包含的应用包名</span></span><br><span class="line">        <span class="type">Uri</span> uri = intent.getData();</span><br><span class="line">        <span class="keyword">if</span>(action.equals(<span class="string">"android.intent.action.PACKAGE_ADDED"</span>))&#123;</span><br><span class="line">            <span class="type">System</span>.out.println(uri + <span class="string">"被安装了"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(action.equals(<span class="string">"android.intent.action.PACKAGE_REPLACED"</span>))&#123;</span><br><span class="line">            <span class="type">System</span>.out.println(uri + <span class="string">"被更新了"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(action.equals(<span class="string">"android.intent.action.PACKAGE_REMOVED"</span>))&#123;</span><br><span class="line">            <span class="type">System</span>.out.println(uri + <span class="string">"被卸载了"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="常见的-Action-常量"><a href="#常见的-Action-常量" class="headerlink" title="常见的 Action 常量"></a>常见的 Action 常量</h3><ul>
<li><p>ACTION_TIME_CHANGED：系统时间被改变。</p>
</li>
<li><p>ACTION_DATE_CHANGED：系统日期被改变。</p>
</li>
<li><p>ACTION_TIMEZONE_CHANGED：系统时区被改变。</p>
</li>
<li><p>ACTION_BOOT_COMPLETED：系统启动完成。</p>
</li>
<li><p>ACTION_PACKAGE_ADDED：系统添加包。</p>
</li>
<li><p>ACTION_PACKAGE_CHANGED：系统的包改变。</p>
</li>
<li><p>ACTION_PACKAGE_REMOVED：系统的包被删除。</p>
</li>
<li><p>ACTION_PACKAGE_RESTARTED：系统的包被重启。</p>
</li>
<li><p>ACTION_PACKAGE_DATA_CLEARED：系统的包数据被清空。</p>
</li>
<li><p>ACTION_BATTERY_CHANGED：电池电量改变。</p>
</li>
<li><p>ACTION_BATTERY_LOW：电池电量低。</p>
</li>
<li><p>ACTION_POWER_CONNECTED：系统连接电源。</p>
</li>
<li><p>ACTION_POWER_DISCONNECTED：系统与电源断开。</p>
</li>
<li><p>ACTION_SHUTDOWN：系统被关闭。</p>
</li>
</ul>
<p>&#8195;&#8195;通过使用BroadcastReceiver来监听特殊的广播，就可以让应用随系统执行特定的操作。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.leoyanblog.com/post/2017/03/05.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Leo Yan">
      <meta itemprop="description" content="离经不叛道，特立不独行。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeoYan Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/post/2017/03/05.html" class="post-title-link" itemprop="url">Android 之 BroadcastReceiver (一) 相关知识</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-03-05 10:00:00" itemprop="dateCreated datePublished" datetime="2017-03-05T10:00:00+08:00">2017-03-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2017-03-27 11:51:42" itemprop="dateModified" datetime="2017-03-27T11:51:42+08:00">2017-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">四大组件</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6/BroadcastReceiver/" itemprop="url" rel="index"><span itemprop="name">BroadcastReceiver</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>转载请注明出处：<a href="http://www.leoyanblog.com">www.leoyanblog.com</a></p>
<p>本文出自 LeoYan 的博客</p>
<p>本文同步发表于我的微信公众号，扫一扫文章底部的二维码或在微信搜索 LeoYan 即可关注。</p>
</blockquote>
<h2 id="BroadcastReceiver-是什么"><a href="#BroadcastReceiver-是什么" class="headerlink" title="BroadcastReceiver 是什么"></a>BroadcastReceiver 是什么</h2><p>&#8195;&#8195;BroadcastReceiver 是 Android 四大组件之一，本质是一种全局的监听器，用于监听系统或者应用全局的广播消息，然后根据广播信息做出相应的逻辑处理，也可以用来传输少量、频率低的数据。 因此它可以非常方便的实现不同组件之间的通信。  </p>
<h2 id="BroadcastReceiver-的生命周期"><a href="#BroadcastReceiver-的生命周期" class="headerlink" title="BroadcastReceiver 的生命周期"></a>BroadcastReceiver 的生命周期</h2><p>&#8195;&#8195;由于 BroadcastReceiver 本质上属于一个监听器，因此实现 BroadcastReceiver 的方法也十分简单，每次系统 Broadcast 事件发生后，系统就会创建对应的 BroadcastReceiver 的实例，并且自动触发他的 onReceive() 方法，onReceive() 方法执行完后，BroadcastReceiver 的实例就会被销毁。也就是说 BroadcastReceiver 的生命周期就是 onReceive() 这个方法。</p>
<p>&#8195;&#8195;如果 BroadcastReceiver 的 onReceive() 方法不能在10秒内执行完成，Android 会认为该程序无响应。所以不要在 BroadcastReceiver 的 onReceive() 方法中执行一些耗时操作，否则会弹出 ANR 的对话框。若必须要执行比较耗时的操作，则要考虑由当前 BroadcastReceiver 启动新的 Service 来完成操作。但不能绑定 Service。</p>
<p>&#8195;&#8195;如果我们在 Activity 中注册了 BroadcastReceiver，当这个 Activity 销毁的时候要主动撤销注册否则会出现异常。</p>
<h2 id="BroadcastReceiver-的创建"><a href="#BroadcastReceiver-的创建" class="headerlink" title="BroadcastReceiver 的创建"></a>BroadcastReceiver 的创建</h2><p>&#8195;&#8195;首先，我们来演示一下创建一个 BroadcastReceiver，并让这个 BroadcastReceiver 能够根据我们的需要来运行。</p>
<p>&#8195;&#8195;要创建自己的 BroadcastReceiver 对象，我们需要继承 android.content.BroadcastReceiver，并实现其 onReceive 方法。下面我们就创建一个名为 MyReceiver 广播接收者：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;  </span><br><span class="line">      </span><br><span class="line">    <span class="keyword">private</span> static <span class="keyword">final</span> <span class="type">String</span> <span class="type">TAG</span> = <span class="string">"MyReceiver"</span>;  </span><br><span class="line">      </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    public void onReceive(<span class="type">Context</span> context, <span class="type">Intent</span> intent) &#123;  </span><br><span class="line">        <span class="type">String</span> msg = intent.getStringExtra(<span class="string">"msg"</span>);  </span><br><span class="line">        <span class="type">Log</span>.i(<span class="type">TAG</span>, msg);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&#8195;&#8195;在 onReceive 方法内，我们可以获取随广播而来的 Intent 中的数据，这非常重要，就像无线电一样，包含很多有用的信息。<br>在创建完我们的 BroadcastReceiver 之后，还不能够使它进入工作状态，我们需要为它注册一个指定的广播地址。没有注册广播地址的 BroadcastReceiver 就像一个缺少选台按钮的收音机，虽然功能俱备，但也无法收到电台的信号。下面我们就来介绍一下如何为 BroadcastReceiver 注册广播地址。</p>
<h2 id="BroadcastReceiver的注册"><a href="#BroadcastReceiver的注册" class="headerlink" title="BroadcastReceiver的注册"></a>BroadcastReceiver的注册</h2><p>&#8195;&#8195;BroadcastReceiver 的注册方式有且只有两种，一种是静态注册（推荐使用），另外一种是动态注册，广播接收者在注册后就开始监听系统或者应用之间发送的广播消息。</p>
<h3 id="静态注册"><a href="#静态注册" class="headerlink" title="静态注册"></a>静态注册</h3><p>&#8195;&#8195;静态注册是在 AndroidManifest.xml 文件中配置的，在 application 里面定义 receiver 并设置要接收的 action。我们就来为 MyBroadcastReceiver 注册一个广播地址：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">".MyBroadcastReceiver"</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span> <span class="attr">android:priority</span> = <span class="string">"777"</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MY_BROADCAST"</span>/&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&#8195;&#8195;这里的 priority 取值是 -1000 到 1000，值越大优先级越高。配置了以上信息之后，只要是 android.intent.action.MY_BROADCAST 这个地址的广播，MyBroadcastReceiver 都能够接收的到。</p>
<p>&#8195;&#8195;要销毁掉静态注册的广播接收者，可以通过调用 PackageManager 将 Receiver 禁用。</p>
<h3 id="动态注册"><a href="#动态注册" class="headerlink" title="动态注册"></a>动态注册</h3><p>&#8195;&#8195;动态注册需要在代码中动态的指定广播地址并注册，通常我们是在 Activity 或 Service 中声明 BroadcastReceiver 的扩展对象，在 onResume 中注册，onPause 中卸载。下面我们就来看一下注册的代码：
　　　</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">MyBroadcastReceiver</span> receiver;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">     <span class="keyword">protected</span> void onResume() &#123;</span><br><span class="line">        <span class="comment">// 动态注册广播 (代码执行到这才会开始监听广播消息，并对广播消息作为相应的处理)</span></span><br><span class="line">        receiver = <span class="keyword">new</span> <span class="type">MyBroadcastReceiver</span>();</span><br><span class="line">        <span class="type">IntentFilter</span> intentFilter = <span class="keyword">new</span> <span class="type">IntentFilter</span>( <span class="string">"android.provider.Telephony.SMS_RECEIVED"</span> );</span><br><span class="line">        registerReceiver( receiver , intentFilter);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">super</span>.onResume();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void onPause() &#123;  </span><br><span class="line">        <span class="comment">// 撤销注册 (撤销注册后广播接收者将不会再监听系统的广播消息)</span></span><br><span class="line">        unregisterReceiver(receiver);</span><br><span class="line">        <span class="keyword">super</span>.onPause();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，当这个 Activity 或 Service 被销毁时如果没有解除注册，系统会报一个异常，提示我们是否忘记解除注册了。所以，记得在特定的地方执行解除注册操作。</p>
</blockquote>
<h3 id="静态注册和动态注册的区别"><a href="#静态注册和动态注册的区别" class="headerlink" title="静态注册和动态注册的区别"></a>静态注册和动态注册的区别</h3><ul>
<li>区别 1</li>
</ul>
<p>&#8195;&#8195;静态注册的广播接收者是一个常驻在系统中的全局监听器，也就是说无论应用是否处于运行状态，如果有广播信息传来，MyBroadcastReceiver 也会被系统调用而自动运行。</p>
<p>&#8195;&#8195;动态注册方式与静态注册相反，不是常驻型的，也就是说广播会跟随程序的生命周期。</p>
<ul>
<li>区别 2</li>
</ul>
<p>&#8195;&#8195;当广播接收者通过 Intent 启动一个 Activity 或者 Service 时，如果 Intent 中无法匹配到相应的组件。动态注册的广播接收者将会导致应用报错。而静态注册的广播接收者将不会有任何报错，因为自从应用安装完成后，广播接收者跟应用已经脱离了关系。　</p>
<h2 id="Broadcast-的类型"><a href="#Broadcast-的类型" class="headerlink" title="Broadcast 的类型"></a>Broadcast 的类型</h2><p>&#8195;&#8195;发送广播主要有两种类型：</p>
<h3 id="普通广播"><a href="#普通广播" class="headerlink" title="普通广播"></a>普通广播</h3><p>&#8195;&#8195;普通广播对于多个接收者来说是完全异步的，通常每个接收者都无需等待即可以接收到广播，接收者相互之间不会有影响。同级别的接收顺序先后是随机的；不同级别的接收顺序是级别高的先于级别低的收到广播；对于这种广播，接收者无法终止广播，即无法阻止其他接收者的接收动作。
　　</p>
<h3 id="有序广播"><a href="#有序广播" class="headerlink" title="有序广播"></a>有序广播</h3><p>&#8195;&#8195;有序广播比较特殊，它每次只发送到优先级较高的接收者那里，然后由优先级高的接收者将处理好的数据再传播到优先级低的接收者那里，优先级高的接收者有能力调用 abortBroadcast() 来终止这个广播。</p>
<p>&#8195;&#8195;同级别接收是先后是随机的，如果先接收到的把广播截断了，同级别的例外的接收者是无法收到该广播。</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 发送有序广播</span></span><br><span class="line">send<span class="constructor">OrderedBroadcast(<span class="params">intent</span>, <span class="params">null</span>)</span>;</span><br></pre></td></tr></table></figure>

<p>&#8195;&#8195;演示有序广播的流程，如下：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public void on<span class="constructor">Receive(Context <span class="params">arg0</span>, Intent <span class="params">intent</span>)</span> &#123;</span><br><span class="line">　　<span class="comment">//获取上一个广播的bundle数据</span></span><br><span class="line">　　Bundle bundle = get<span class="constructor">ResultExtras(<span class="params">true</span>)</span>;<span class="comment">//true：前一个广播没有结果时创建新的Bundle；false：不创建Bundle</span></span><br><span class="line">　　bundle.put<span class="constructor">String(<span class="string">"key"</span>, <span class="string">"777"</span>)</span>;</span><br><span class="line">　　<span class="comment">//将bundle数据放入广播中传给下一个广播接收者</span></span><br><span class="line">　　set<span class="constructor">ResultExtras(<span class="params">bundle</span>)</span>;　</span><br><span class="line">　　</span><br><span class="line">　　<span class="comment">//终止广播传给下一个广播接收者</span></span><br><span class="line">　　abort<span class="constructor">Broadcast()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li><p>静态广播接收的处理器是由 PackageManagerService 负责，当手机启动或者新安装了应用的时候，PackageManagerService 会扫描手机中所有已安装的APP应用，将 AndroidManifest.xml 中有关注册广播的信息解析出来，存储至一个全局静态变量当中。</p>
</li>
<li><p>动态广播接收的处理器是由 ActivityManagerService 负责，当 APP 的服务或者进程起来之后，执行了注册广播接收的代码逻辑，即进行加载，最后会存储在一个另外的全局静态变量中。需要注意的是：</p>
</li>
</ul>
<p>&#8195;&#8195;1、这个并非是一成不变的，当程序被杀死之后，已注册的动态广播接收器也会被移出全局变量，直到下次程序启动，再进行动态广播的注册，当然这里面的顺序也已经变更了一次。</p>
<p>&#8195;&#8195;2、这里也并没完整的进行广播的排序，只记录注册的先后顺序，并未有结合优先级的处理。</p>
<ul>
<li>广播发出的时候，广播接收者的接收顺序如下：</li>
</ul>
<p>&#8195;&#8195;1、当广播为 <strong>普通广播</strong> 时，有如下的接收顺序：</p>
<p>&#8195;&#8195;&#8195;&#8195;无视优先级</p>
<p>&#8195;&#8195;&#8195;&#8195;动态优先于静态</p>
<p>&#8195;&#8195;&#8195;&#8195;同优先级的动态广播接收器，<strong>先注册的大于后注册的</strong></p>
<p>&#8195;&#8195;&#8195;&#8195;同优先级的静态广播接收器，<strong>先扫描的大于后扫描的</strong>　</p>
<p>&#8195;&#8195;2、当广播为 <strong>有序广播</strong>，那么会将动态广播处理器和静态广播处理器合并在一起处理广播的消息，最终确定广播接收的顺序：　</p>
<p>&#8195;&#8195;&#8195;&#8195;优先级高的先接收</p>
<p>&#8195;&#8195;&#8195;&#8195;同优先级的动静态广播接收器，<strong>动态优先于静态</strong></p>
<p>&#8195;&#8195;&#8195;&#8195;同优先级的动态广播接收器，<strong>先注册的大于后注册的</strong></p>
<p>&#8195;&#8195;&#8195;&#8195;同优先级的静态广播接收器，<strong>先扫描的大于后扫描的</strong>　</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.leoyanblog.com/post/2017/03/04.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Leo Yan">
      <meta itemprop="description" content="离经不叛道，特立不独行。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeoYan Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/post/2017/03/04.html" class="post-title-link" itemprop="url">Android Studio 2.3 更新时出现的问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-03-04 10:00:00" itemprop="dateCreated datePublished" datetime="2017-03-04T10:00:00+08:00">2017-03-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2017-03-09 18:26:11" itemprop="dateModified" datetime="2017-03-09T18:26:11+08:00">2017-03-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>转载请注明出处：<a href="http://www.leoyanblog.com">www.leoyanblog.com</a></p>
<p>本文出自 LeoYan 的博客</p>
<p>本文同步发表于我的微信公众号，扫一扫文章底部的二维码或在微信搜索 LeoYan 即可关注。</p>
</blockquote>
<h2 id="Android-Studio-2-3-更新时出现的问题"><a href="#Android-Studio-2-3-更新时出现的问题" class="headerlink" title="Android Studio 2.3 更新时出现的问题"></a>Android Studio 2.3 更新时出现的问题</h2><p>&#8195;&#8195;作为 Google 官方出版并维护的 IDE，被全球数以百万计的 Android 开发者钟爱并使用的开发工具，Android Studio，在 2017 年 3 月 2 日正式迎来了 2.3 稳定版的更新。</p>
<p>&#8195;&#8195;更新新版 Android Studio 时，项目出现了小问题。</p>
<p>&#8195;&#8195;刚打开项目时，项目提示如下：</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/studio_update_01.png" alt="image"></p>
<p>&#8195;&#8195;意思是 Android Gradle 插件的版本是否更新到 2.3.0 。点击更新后，项目的 build.gradle 文件的 gradle 版本号自动更改为 2.3.0。gradle-wrapper.properties 的 gradle 版本号自动更改为 3.3-all。文件如下图：</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/studio_update_02.png" alt="image"></p>
<p><img src="http://oddu03if7.bkt.clouddn.com/studio_update_04.png" alt="image"></p>
<p>&#8195;&#8195;结果项目构建时出现了如下错误：</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/studio_update_03.png" alt="image"></p>
<p>&#8195;&#8195;因为本项目以前用的是 2.14.1 版本的 gradle，所以想着改回去是不是能解决问题。结果又出现了问题。如下图：</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/studio_update_05.png" alt="image"></p>
<p>&#8195;&#8195;看来只能用 3.3 版本的了，然后去这个网址 <a href="https://services.gradle.org/distributions/" target="_blank" rel="noopener">https://services.gradle.org/distributions/</a> 下载了个 gradle-3.3-all.zip 文件。解压到 Android Studio 的安装目录下的 gradle 文件夹下，如下图：</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/studio_update_06.png" alt="image"></p>
<p>&#8195;&#8195;然后，在 Android Studio 的菜单栏，点击 File -&gt; Setting -&gt; Build，Execution，Deployment -&gt; Gradle，设置 Gradle home 的路径，如下图：</p>
<p><img src="http://oddu03if7.bkt.clouddn.com/studio_update_07.png" alt="image"></p>
<p>&#8195;&#8195;点击 Apply，点击 OK。然后重新构建项目，完美解决，一点没毛病。</p>
<blockquote>
<p>本方法不一定适用所有项目，或者在过程中有什么其他问题，请关注微信公众号 LeoYan 来一起讨论。</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.leoyanblog.com/post/2017/02/26.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Leo Yan">
      <meta itemprop="description" content="离经不叛道，特立不独行。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeoYan Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/post/2017/02/26.html" class="post-title-link" itemprop="url">Android 之 Service 相关知识</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-02-26 10:00:00" itemprop="dateCreated datePublished" datetime="2017-02-26T10:00:00+08:00">2017-02-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2017-05-18 18:15:42" itemprop="dateModified" datetime="2017-05-18T18:15:42+08:00">2017-05-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">四大组件</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6/Service/" itemprop="url" rel="index"><span itemprop="name">Service</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>转载请注明出处：<a href="http://www.leoyanblog.com">www.leoyanblog.com</a></p>
<p>本文出自 LeoYan 的博客</p>
<p>本文同步发表于我的微信公众号，扫一扫文章底部的二维码或在微信搜索 LeoYan 即可关注。</p>
</blockquote>
<h2 id="什么是-Service？"><a href="#什么是-Service？" class="headerlink" title="什么是 Service？　　"></a>什么是 Service？　　</h2><p>&#8195;&#8195;Service 是 Android 系统的主要组件之一，Service 的职责是进行一些不需要UI存在的操作，比如网络请求、本地磁盘IO、执行定时任务等。Service 是没有图形界面的，只会在后台默默地运行。</p>
<blockquote>
<p>注：Service 只是在后台运行的一个组件，默认情况下，Service 也是运行在 app 的主线程中的，它并不会开启新的线程或者进程（当然，这个可以做到）。所以，假如在 Service 中执行有耗时的操作的话，最好在子线程中执行。</p>
</blockquote>
<h2 id="Service-的特点"><a href="#Service-的特点" class="headerlink" title="Service 的特点"></a>Service 的特点</h2><p>&#8195;&#8195;没有可视的UI、后台运行，运行不阻塞前台UI、拥有服务的进程具有较高的优先级。</p>
<h2 id="Service-与-Thread-的区别"><a href="#Service-与-Thread-的区别" class="headerlink" title="Service 与 Thread 的区别"></a>Service 与 Thread 的区别</h2><ul>
<li>Thread</li>
</ul>
<p>&#8195;&#8195;Thread 是程序执行的最小单元，它是分配 CPU 的基本单位。可以用 Thread 来执行一些异步的操作。</p>
<ul>
<li>Service</li>
</ul>
<p>&#8195;&#8195;Service 是 Android 的一种机制，当它运行的时候如果是 Local Service，那么对应的 Service 是运行在主进程的 main 线程上的。如：onCreate，onStart 这些函数在被系统调用的时候都是在主进程的 main 线程上运行的。如果是 Remote Service，那么对应的 Service 则是运行在独立进程的 main 线程上。因此请不要把 Service 理解成线程，它跟线程半毛钱的关系都没有！</p>
<p>&#8195;&#8195;既然这样，那么我们为什么要用 Service 呢？其实这跟 Android 的系统机制有关，我们先拿 Thread 来说。Thread 的运行是独立于 Activity 的，也就是说当一个 Activity 被 finish 之后，如果你没有主动停止 Thread 或者 Thread 里的 run 方法没有执行完毕的话，Thread 也会一直执行。因此这里会出现一个问题：当 Activity 被 finish 之后，你不再持有该 Thread 的引用。另一方面，你没有办法在不同的 Activity 中对同一 Thread 进行控制。</p>
<p>&#8195;&#8195;举个例子：如果你的 Thread 需要不停地隔一段时间就要连接服务器做某种同步的话，该 Thread 需要在 Activity 没有 start 的时候也在运行。这个时候当你 start 一个 Activity 就没有办法在该 Activity 里面控制之前创建的 Thread。因此你便需要创建并启动一个 Service ，在 Service 里面创建、运行并控制该 Thread，这样便解决了该问题（因为任何 Activity 都可以控制同一 Service，而系统也只会创建一个对应 Service 的实例）。</p>
<p>&#8195;&#8195;因此你可以把 Service 想象成一种消息服务，而你可以在任何有 Context 的地方调用 Context.startService()、Context.stopService()、Context.bindService()，Context.unbindService()，来控制它，你也可以在 Service 里注册 BroadcastReceiver，在其他地方通过发送 broadcast 来控制它，当然这些都是 Thread 做不到的。</p>
<h2 id="Service-的分类"><a href="#Service-的分类" class="headerlink" title="Service 的分类"></a>Service 的分类</h2><h3 id="按运行分类"><a href="#按运行分类" class="headerlink" title="按运行分类"></a>按运行分类</h3><ul>
<li>前台服务</li>
</ul>
<p>&#8195;&#8195;前台服务是指那些经常会被用户关注的服务，因此内存过低时它不会成为被杀的对象。 前台服务必须提供一个状态栏通知，并会置于“正在进行的”（“Ongoing”）组之下。这意味着只有在服务被终止或从前台移除之后，此通知才能被解除。</p>
<p>&#8195;&#8195;例如，用服务来播放音乐的播放器就应该运行在前台，因为用户会清楚地知晓它的运行情况。 状态栏通知可能会标明当前播放的歌曲，并允许用户启动一个 Activity 来与播放器进行交互。</p>
<p>&#8195;&#8195;要把你的服务请求为前台运行，可以调用 startForeground() 方法。此方法有两个参数：唯一标识通知的整数值、状态栏通知 Notification 对象。例如：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Notification notification = <span class="keyword">new</span> <span class="constructor">Notification(R.<span class="params">drawable</span>.<span class="params">icon</span>, <span class="params">getText</span>(R.<span class="params">string</span>.<span class="params">ticker_text</span>)</span>,<span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>current<span class="constructor">TimeMillis()</span>);</span><br><span class="line"></span><br><span class="line">Intent notificationIntent = <span class="keyword">new</span> <span class="constructor">Intent(<span class="params">this</span>,ExampleActivity.<span class="params">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">PendingIntent pendingIntent = <span class="module-access"><span class="module"><span class="identifier">PendingIntent</span>.</span></span>get<span class="constructor">Activity(<span class="params">this</span>, 0, <span class="params">notificationIntent</span>, 0)</span>;</span><br><span class="line"></span><br><span class="line">notification.set<span class="constructor">LatestEventInfo(<span class="params">this</span>, <span class="params">getText</span>(R.<span class="params">string</span>.<span class="params">notification_title</span>)</span>, get<span class="constructor">Text(R.<span class="params">string</span>.<span class="params">notification_message</span>)</span>, pendingIntent);</span><br><span class="line">        </span><br><span class="line">start<span class="constructor">Foreground(ONGOING_NOTIFICATION, <span class="params">notification</span>)</span>;</span><br></pre></td></tr></table></figure>

<p>&#8195;&#8195;要从前台移除服务，请调用 stopForeground() 方法，这个方法接受个布尔参数，表示是否同时移除状态栏通知。此方法不会终止服务。不过，如果服务在前台运行时被你终止了，那么通知也会同时被移除。</p>
<ul>
<li>后台服务</li>
</ul>
<h3 id="按使用分类"><a href="#按使用分类" class="headerlink" title="按使用分类　　"></a>按使用分类　　</h3><ul>
<li>本地服务</li>
</ul>
<p>&#8195;&#8195;用于应用程序内部，实现一些耗时任务，并不占用应用程序比如 Activity 所属线程，而是单开线程后台执行。</p>
<p>&#8195;&#8195;调用 Context.startService() 启动，调用 Context.stopService() 结束。在内部可以调用 Service.stopSelf() 或 Service.stopSelfResult() 来自己停止。</p>
<ul>
<li>远程服务</li>
</ul>
<p>&#8195;&#8195;用于 Android 系统内部的应用程序之间，可被其他应用程序复用，比如天气预报服务，其他应用程序不需要再写这样的服务，调用已有的即可。可以定义接口并把接口暴露出来，以便其他应用进行操作。客户端建立到服务对象的连接，并通过那个连接来调用服务。调用 Context.bindService() 方法建立连接，并启动，以调用 Context.unbindService() 关闭连接。多个客户端可以绑定至同一个服务。如果服务此时还没有加载，bindService() 会先加载它。</p>
<h2 id="Service生命周期"><a href="#Service生命周期" class="headerlink" title="Service生命周期"></a>Service生命周期</h2><p>　　<img src="http://oddu03if7.bkt.clouddn.com/service_lifecycle.png" alt="Service生命周期"></p>
<p>&#8195;&#8195;Android Service 的生命周期并不像 Activity 那么复杂，它只继承了 onCreate(), onStart(), onDestroy() 三个方法，当我们第一次启动 Service 时，先后调用了 onCreate(), onStart() 这两个方法，当停止 Service 时，则执行 onDestroy() 方法，这里需要注意的是，如果 Service 已经启动了，当我们再次启动 Service 时，不会在执行 onCreate() 方法，而是直接执行 onStart() 方法，具体的可以看下面的实例。</p>
<p>Service 生命周期方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> mStartMode;       <span class="comment">// 标识服务被杀死后的处理方式</span></span><br><span class="line">    IBinder mBinder;      <span class="comment">// 用于客户端绑定的接口</span></span><br><span class="line">    <span class="keyword">boolean</span> mAllowRebind; <span class="comment">// 标识是否使用onRebind</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 服务正被创建</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 服务正在启动，由startService()调用引发</span></span><br><span class="line">        <span class="keyword">return</span> mStartMode;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 客户端用bindService()绑定服务</span></span><br><span class="line">        <span class="keyword">return</span> mBinder;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onUnbind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 所有的客户端都用unbindService()解除了绑定</span></span><br><span class="line">        <span class="keyword">return</span> mAllowRebind;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRebind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 某客户端正用bindService()绑定到服务,</span></span><br><span class="line">        <span class="comment">// 而onUnbind()已经被调用过了</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 服务用不上了，将被销毁</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>请注意 onStartCommand() 方法必须返回一个整数。这个整数是描述系统在杀死服务之后应该如何继续运行。onStartCommand() 的返回值必须是以下常量之一：</p>
<p>START_NOT_STICKY</p>
<p>&#8195;&#8195;如果系统在 onStartCommand() 返回后杀死了服务，则不会重建服务了，除非还存在未发送的 intent。 当服务不再是必需的，并且应用程序能够简单地重启那些未完成的工作时，这是避免服务运行的最安全的选项。　</p>
<p>START_STICKY</p>
<p>&#8195;&#8195;如果系统在 onStartCommand() 返回后杀死了服务，则将重建服务并调用 onStartCommand()，但不会再次送入上一个 intent， 而是用 null intent 来调用 onStartCommand()。除非还有启动服务的 intent 未发送完，那么这些剩下的 intent 会继续发送。 这适用于媒体播放器（或类似服务），它们不执行命令，但需要一直运行并随时待命。</p>
<p>START_REDELIVER_INTENT</p>
<p>&#8195;&#8195;如果系统在 onStartCommand() 返回后杀死了服务，则将重建服务并用上一个已送过的 intent 调用 onStartCommand()。任何未发送完的 intent 也都会依次送入。这适用于那些需要立即恢复工作的活跃服务，比如下载文件。</p>
</blockquote>
<p>&#8195;&#8195;服务的生命周期与 Activity 的非常类似。不过，更重要的是你需密切关注服务的创建和销毁环节，因为后台运行的服务是不会引起用户注意的。</p>
<p>&#8195;&#8195;通过实现这些方法，您可以监控服务生命周期的两个嵌套循环：</p>
<ul>
<li>服务的整个生命周期从调用 onCreate() 开始起，到 onDestroy() 返回时结束。与 Activity 类似，服务也在 onCreate() 中完成初始设置，并在 onDestroy() 中释放所有剩余资源。例如，音乐播放服务可以在 onCreate() 中创建用于播放音乐的线程，然后在 onDestroy() 中停止该线程。</li>
</ul>
<p>&#8195;&#8195;无论服务是通过 startService() 还是 bindService() 创建，都会为所有服务调用 onCreate() 和 onDestroy() 方法。</p>
<ul>
<li>服务的有效生命周期从调用 onStartCommand() 或 onBind() 方法开始。每种方法均有 Intent 对象传入，该对象分别传递到 startService() 或 bindService()。</li>
</ul>
<p>&#8195;&#8195;对于启动服务，有效生命周期与整个生命周期同时结束（即便是在 onStartCommand() 返回之后，服务仍然处于活动状态）。对于绑定服务，有效生命周期在 onUnbind() 返回时结束。</p>
<blockquote>
<p>注：尽管启动服务是通过调用 stopSelf() 或 stopService() 来停止，但是该服务并无相应的回调（没有 onStop() 回调）。因此，除非服务绑定到客户端，否则在服务停止时，系统会将其销毁 — onDestroy() 是接收到的唯一回调。</p>
</blockquote>
<h2 id="在manifest中声明服务"><a href="#在manifest中声明服务" class="headerlink" title="在manifest中声明服务"></a>在manifest中声明服务</h2><p>&#8195;&#8195;如同 Activity（以及其他组件）一样，您必须在应用的清单文件中声明所有服务。</p>
<p>&#8195;&#8195;要声明服务，请添加 <service> 元素作为 <application> 元素的子元素。例如：</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;manifest <span class="string">...</span> &gt;</span><br><span class="line">  <span class="string">...</span></span><br><span class="line">  &lt;application <span class="string">...</span> &gt;</span><br><span class="line">      &lt;service android<span class="function">:name</span>=<span class="string">".ExampleService"</span> /&gt;</span><br><span class="line">      <span class="string">...</span></span><br><span class="line">  &lt;<span class="string">/application</span>&gt;</span><br><span class="line">&lt;<span class="string">/manifest</span>&gt;</span><br></pre></td></tr></table></figure>

<p>Service 元素的属性有：</p>
<blockquote>
<p>android:name　　————-　　服务类名</p>
<p>android:label　　————–　　服务的名字，如果此项不设置，那么默认显示的服务名则为类名</p>
<p>android:icon　　————–　　服务的图标</p>
<p>android:permission　　——-　　申明此服务的权限，这意味着只有提供了该权限的应用才能控制或连接此服务</p>
<p>android:process　　———-　　表示该服务是否运行在另外一个进程，如果设置了此项，那么将会在包名后面加上这段字符串表示另一进程的名字</p>
<p>android:enabled　　———-　　如果此项设置为 true，那么 Service 将会默认被系统启动，不设置默认此项为 false</p>
<p>android:exported　　———　　表示该服务是否能够被其他应用程序所控制或连接，不设置默认此项为 false　</p>
</blockquote>
<p>&#8195;&#8195;android:name 是唯一必需的属性——它定义了服务的类名。与 activity 一样，服务可以定义 intent 过滤器，使得其它组件能用隐式 intent 来调用服务。如果你想让服务只能内部使用（其它应用程序无法调用），那么就不必（也不应该）提供任何 intent 过滤器。</p>
<p>&#8195;&#8195;此外，如果包含了 android:exported 属性并且设置为 “false”， 就可以确保该服务是你应用程序的私有服务。即使服务提供了 intent 过滤器，本属性依然生效。　</p>
<h2 id="Service-启动方式"><a href="#Service-启动方式" class="headerlink" title="Service 启动方式"></a>Service 启动方式</h2><h3 id="startService"><a href="#startService" class="headerlink" title="startService()"></a>startService()</h3><p>&#8195;&#8195;从 Activity 或其它应用程序组件中可以启动一个服务，调用 startService() 并传入一个Intent（指定所需启动的服务）即可。</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">	Intent intent = <span class="keyword">new</span> <span class="constructor">Intent(<span class="params">this</span>, MyService.<span class="params">class</span>)</span>;</span><br><span class="line">start<span class="constructor">Service(<span class="params">intent</span>)</span>;</span><br></pre></td></tr></table></figure>

<p>服务类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * onBind 是 Service 的虚方法，因此我们不得不实现它。</span></span><br><span class="line"><span class="comment">     * 返回 null，表示客服端不能建立到此服务的连接。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span>  　　 </span>&#123;  	</span><br><span class="line">    <span class="comment">//接受传递过来的intent的数据 </span></span><br><span class="line">     <span class="keyword">return</span> START_STICKY; </span><br><span class="line">    &#125;;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&#8195;&#8195;一个 started 服务必须自行管理生命周期。也就是说，系统不会终止或销毁这类服务，除非必须恢复系统内存并且服务返回后一直维持运行。 因此，服务必须通过调用 stopSelf() 自行终止，或者其它组件可通过调用 stopService() 来终止它。</p>
<h3 id="bindService"><a href="#bindService" class="headerlink" title="bindService()　　"></a>bindService()　　</h3><p>&#8195;&#8195;当应用程序中的 Activity 或其它组件需要与服务进行交互，或者应用程序的某些功能需要暴露给其它应用程序时，你应该创建一个 bound 服务，并通过进程间通信（IPC）来完成。</p>
<p>方法如下：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Intent intent=<span class="keyword">new</span> <span class="constructor">Intent(<span class="params">this</span>,BindService.<span class="params">class</span>)</span>; </span><br><span class="line">bind<span class="constructor">Service(<span class="params">intent</span>, ServiceConnection <span class="params">conn</span>, <span class="params">int</span> <span class="params">flags</span>)</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意 bindService 是 Context 中的方法，当没有 Context 时传入即可。</p>
</blockquote>
<p>在进行服务绑定的时，其 flags 有：</p>
<ul>
<li>Context.BIND_AUTO_CREATE    </li>
</ul>
<p>&#8195;&#8195;表示收到绑定请求的时候，如果服务尚未创建，则即刻创建，在系统内存不足需要先摧毁优先级组件来释放内存，且只有驻留该服务的进程成为被摧毁对象时，服务才被摧毁　</p>
<ul>
<li>Context.BIND_DEBUG_UNBIND    　</li>
</ul>
<p>&#8195;&#8195;通常用于调试场景中判断绑定的服务是否正确，但容易引起内存泄漏，因此非调试目的的时候不建议使用</p>
<ul>
<li>Context.BIND_NOT_FOREGROUND    　</li>
</ul>
<p>&#8195;&#8195;表示系统将阻止驻留该服务的进程具有前台优先级，仅在后台运行。</p>
<p>服务类：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">BindService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	 <span class="comment">// 实例化MyBinder得到mybinder对象；</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="type">MyBinder</span> binder = <span class="keyword">new</span> <span class="type">MyBinder</span>();</span><br><span class="line">	</span><br><span class="line">	  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回Binder对象。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	public <span class="type">IBinder</span> onBind(<span class="type">Intent</span> intent) &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">return</span> binder;</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">      * 新建内部类MyBinder，继承自Binder(Binder实现IBinder接口),</span></span><br><span class="line"><span class="comment">      * MyBinder提供方法返回BindService实例。</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">　　public <span class="class"><span class="keyword">class</span> <span class="title">MyBinder</span> <span class="keyword">extends</span> <span class="title">Binder</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">        public <span class="type">BindService</span> getService()&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">BindService</span>.<span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	public boolean onUnbind(<span class="type">Intent</span> intent) &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">super</span>.onUnbind(intent);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动服务的 Activity 代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 是否绑定 */</span>  </span><br><span class="line">	<span class="keyword">boolean</span> mIsBound = <span class="keyword">false</span>; </span><br><span class="line">	BindService mBoundService;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">		setContentView(R.layout.activity_main);</span><br><span class="line">		doBindService();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 实例化ServiceConnection接口的实现类,用于监听服务的状态</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> ServiceConnection conn = <span class="keyword">new</span> ServiceConnection() &#123;  </span><br><span class="line">		  </span><br><span class="line">	    <span class="meta">@Override</span>  </span><br><span class="line">	    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>&#123;  </span><br><span class="line">	        BindService mBoundService = ((BindService.MyBinder) service).getService();  </span><br><span class="line">	        </span><br><span class="line">	    &#125;  </span><br><span class="line">	  </span><br><span class="line">	    <span class="meta">@Override</span>  </span><br><span class="line">	    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span> </span>&#123;  </span><br><span class="line">	        mBoundService = <span class="keyword">null</span>;  </span><br><span class="line">	     </span><br><span class="line">	    &#125;  </span><br><span class="line">	&#125;; </span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 绑定服务 */</span>  </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doBindService</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">	    bindService(<span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>, BindService<span class="class">.<span class="keyword">class</span>), <span class="title">conn</span>,<span class="title">Context</span>.<span class="title">BIND_AUTO_CREATE</span>)</span>;  </span><br><span class="line">	    mIsBound = <span class="keyword">true</span>;  </span><br><span class="line">	&#125;  </span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 解除绑定服务 */</span>  </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doUnbindService</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">	    <span class="keyword">if</span> (mIsBound) &#123;  </span><br><span class="line">	        <span class="comment">// Detach our existing connection.  </span></span><br><span class="line">	        unbindService(conn);  </span><br><span class="line">	        mIsBound = <span class="keyword">false</span>;  </span><br><span class="line">	    &#125;  </span><br><span class="line">	&#125; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">super</span>.onDestroy();</span><br><span class="line">		</span><br><span class="line">		doUnbindService();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意 在AndroidMainfest.xml 中对 Service 进行显式声明</p>
</blockquote>
<p>判断 Service 是否正在运行：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isServiceRunning</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ActivityManager manager = (ActivityManager) getSystemService(ACTIVITY_SERVICE);</span><br><span class="line">    </span><br><span class="line"> 　&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"com.example.demo.BindService"</span>.equals(service.service.getClassName())) 　　&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.leoyanblog.com/post/2017/02/19.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Leo Yan">
      <meta itemprop="description" content="离经不叛道，特立不独行。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeoYan Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/post/2017/02/19.html" class="post-title-link" itemprop="url">Android 之 Activity (三) Task 和 LaunchMode</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-02-19 10:00:00" itemprop="dateCreated datePublished" datetime="2017-02-19T10:00:00+08:00">2017-02-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2017-03-27 11:50:42" itemprop="dateModified" datetime="2017-03-27T11:50:42+08:00">2017-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">四大组件</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6/Activity/" itemprop="url" rel="index"><span itemprop="name">Activity</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>转载请注明出处：<a href="http://www.leoyanblog.com">www.leoyanblog.com</a></p>
<p>本文出自 LeoYan 的博客</p>
<p>本文同步发表于我的微信公众号，扫一扫文章底部的二维码或在微信搜索 LeoYan 即可关注。</p>
</blockquote>
<h2 id="Activity的任务和启动模式"><a href="#Activity的任务和启动模式" class="headerlink" title="Activity的任务和启动模式"></a>Activity的任务和启动模式</h2><h3 id="任务与返回栈"><a href="#任务与返回栈" class="headerlink" title="任务与返回栈"></a>任务与返回栈</h3><h4 id="后进先出原则"><a href="#后进先出原则" class="headerlink" title="后进先出原则"></a>后进先出原则</h4><p><img src="http://oddu03if7.bkt.clouddn.com/diagram_backstack.png" alt="后进先出"></p>
<p>&#8195;&#8195;Task 就好像是能包含很多 Activity 的栈。默认情况下，一个 Activity 启动另外一个 Activity 时，两个 Activity 是放在同一个 Task 栈中的，第二个 Activity 压入第一个 Activity 所在的 Task 栈。当用户按“返回”按钮时，第二  Activity 从栈中弹出，第一个 Activity 恢复执行。直到用户返回主屏幕为止（或者，返回 Task 中正在运行的任意 Activity）。当所有 Activity 均从堆栈中移除后，Task 即不复存在。</p>
<h4 id="多任务"><a href="#多任务" class="headerlink" title="多任务"></a>多任务</h4><p><img src="http://oddu03if7.bkt.clouddn.com/diagram_multitasking.png" alt="多任务"></p>
<p>&#8195;&#8195;Task 是一个有机整体，当用户开始新 Task 或通过“主页”按钮转到主屏幕时，可以移动到“后台”。 尽管在后台时，该任务中的所有 Activity 全部停止，但是 Task 的返回栈仍旧不变，也就是说，当另一个 Task 发生时，该 Task 仅仅失去焦点而已，如上图中所示。然后， Task 可以返回到“前台”，用户就能够回到离开时的状态。</p>
<blockquote>
<p>注：后台可以同时运行多个 Task 。但是，如果用户同时运行多个后台 Task ，则系统可能会开始销毁后台 Activity，以回收内存资源，从而导致 Activity 状态丢失。</p>
</blockquote>
<h4 id="可多次实例化"><a href="#可多次实例化" class="headerlink" title="可多次实例化"></a>可多次实例化</h4><p><img src="http://oddu03if7.bkt.clouddn.com/diagram_multiple_instances.png" alt="多次实例化"></p>
<p>&#8195;&#8195;应用中的一个 Activity 可能会多次实例化，如上图所示。因此，如果用户使用“返回”按钮向后导航，则会按 Activity 每个实例的打开顺序显示这些实例（每个实例的 UI 状态各不相同）。</p>
<h4 id="任务的默认行为总结"><a href="#任务的默认行为总结" class="headerlink" title="任务的默认行为总结"></a>任务的默认行为总结</h4><ul>
<li>当 Activity A 启动 Activity B 时，Activity A 将会停止，但系统会保留其状态（例如，滚动位置和已输入表单中的文本）。如果用户在处于 Activity B 时按“返回”按钮，则 Activity A 将恢复其状态，继续执行。</li>
<li>用户通过按“主页”按钮离开任务时，当前 Activity 将停止且其任务会进入后台。 系统将保留任务中每个 Activity 的状态。如果用户稍后通过选择开始任务的启动器图标来恢复任务，则任务将出现在前台并恢复执行堆栈顶部的 Activity。</li>
<li>如果用户按“返回”按钮，则当前 Activity 会从堆栈弹出并被销毁。 堆栈中的前一个 Activity 恢复执行。销毁 Activity 时，系统不会保留该 Activity 的状态。</li>
<li>即使来自其他任务，Activity 也可以多次实例化。</li>
</ul>
<h3 id="LaunchMode简介"><a href="#LaunchMode简介" class="headerlink" title="LaunchMode简介"></a>LaunchMode简介</h3><p>&#8195;&#8195;LaunchMode 是 Activity 类的一个属性，该属性包括4个具体值：standard、singleTop、singleTask、singleInstance。我们都知道，Android 系统中启动 Activity 是通过 Intent 实例进行的，当系统收到一个 Intent 的实例需要去启动指定的 Activity 的时候，Android 系统会根据目标 Activity 的该属性值来决定是要要创建新的该 Activity 实例以及如何在 Task 中创建该 Activity 的实例。这就是 LaunchMode 这个属性的作用。</p>
<h4 id="LaunchMode-分为两个类别"><a href="#LaunchMode-分为两个类别" class="headerlink" title="LaunchMode 分为两个类别"></a>LaunchMode 分为两个类别</h4><ul>
<li>普通类型</li>
</ul>
<p>&#8195;&#8195;用户常用的启动模式类型，大部分 Activity都是这两种启动模式。包括 standard 和 singleTop 两种启动模式</p>
<ul>
<li>特殊类型</li>
</ul>
<p>&#8195;&#8195;具有特殊的行为的启动模式，只针对特殊需求的使用。包括 singleTask 和 singleInstance 两种启动模式</p>
<p>官方文档对4中启动模式描述如下：</p>
<table>
<thead>
<tr>
<th align="center">使用场景</th>
<th align="center">启动模式</th>
<th align="center">是否可以有多个实例？</th>
<th align="center">简介</th>
</tr>
</thead>
<tbody><tr>
<td align="center">普通类型</td>
<td align="center">standard</td>
<td align="center">是</td>
<td align="center">系统默认的启动模式，当系统接收到一个 Intent 实例去启动一个 standard 模式的 Activity 时，系统总是会在目标栈的顶部创建一个新的 Activity 实例，并把 Intent 的实例传进去。</td>
</tr>
<tr>
<td align="center">普通类型</td>
<td align="center">singleTop</td>
<td align="center">视具体情况</td>
<td align="center">当系统接收到一个 Intent 实例去启动一个 singleTop 模式的 Activity 时，如果在目标栈的顶部存在一个该 Activity 的实例的话，那么系统就会重用这个 Activity 的实例而不创建新的实例，并回调该 Activity 的 onNewIntent(Intent intent) 方法把新的 Intent 实例当作方法参数传递进去；如果在目标栈的顶部没有该 Activity 的实例的话系统将会在新建一个 Activity 实例，与 standard 的行为就一样了。</td>
</tr>
<tr>
<td align="center">特殊类型</td>
<td align="center">singleTask</td>
<td align="center">否</td>
<td align="center">当系统接收到一个 Intent 实例去启动一个 singleTask 模式的 Activity 时，如果不存在该 Activity 的实例的话，系统会先创建一个新的 Task，并在该 Task 底部里面创建一个该 Activity 的实例，随后把 Intent 实例传递进去；如果已经存在一个该 Activity 的实例的话，系统就不会再创建新的实例，那么系统就会重用这个 Activity 的实例而不创建新的实例，并回调该 Activity 的 onNewIntent(Intent intent) 方法把新的 Intent 实例当作方法参数传递进去，同时，该 Activity 实例所在的 Task 将会被调到前台。</td>
</tr>
<tr>
<td align="center">特殊类型</td>
<td align="center">singleInstance</td>
<td align="center">否</td>
<td align="center">类似于 singleTask ，唯一不同的地方在于，singleInstance 的 Activity 不允许自己的 Task 中存在其他的 Activity 实例，也就是说 singleInstance 的 Activity 永远是 Task 中唯一的一个 Activity 实例。</td>
</tr>
</tbody></table>
<h4 id="LaunchMode-的定义"><a href="#LaunchMode-的定义" class="headerlink" title="LaunchMode 的定义"></a>LaunchMode 的定义</h4><ul>
<li>静态定义：在目标 Activity 的 mainfest 中使用标签静态定义</li>
<li>动态定义：在启动目标 Activity 的 Intent 对象中使用不同的 flag 定义，可以用来定义 LaunchMode 的 flag 有以下三个：</li>
</ul>
<table>
<thead>
<tr>
<th align="center">flag</th>
<th align="center">对应的 LaunchMode</th>
</tr>
</thead>
<tbody><tr>
<td align="center">FLAG_ACTIVITY_NEW_TASK</td>
<td align="center">singleTask</td>
</tr>
<tr>
<td align="center">FLAG_ACTIVITY_SINGLE_TOP</td>
<td align="center">singleTop</td>
</tr>
<tr>
<td align="center">FLAG_ACTIVITY_CLEAR_TOP</td>
<td align="center">无对应的LaunchMode</td>
</tr>
</tbody></table>
<blockquote>
<p>注：在Activity A启动 Activity B的时候，假如B已经在 mainfest 文件中定义过 LaunchMode，此时的 Intent 对象中也有定义 LaunchMode，这时候以 Activity A start B 的时候以 Intent 中定义的为准。</p>
</blockquote>
<h4 id="典型使用场景"><a href="#典型使用场景" class="headerlink" title="典型使用场景"></a>典型使用场景</h4><table>
<thead>
<tr>
<th align="center">LaunchMode</th>
<th align="center">使用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="center">standard</td>
<td align="center">绝大多数标准的跳转</td>
</tr>
<tr>
<td align="center">singleTop</td>
<td align="center">新闻阅读类的内容页面，假如在一个新闻页面又打开了另一个新闻页面，这时候Task的顶端已经有该Activity的实例了，就不用再初始化了</td>
</tr>
<tr>
<td align="center">singleTask</td>
<td align="center">通知栏启动其他app，一般都会在Intent中加上FLAG_ACTIVITY_NEW_TASK，相当于使用了singleTask</td>
</tr>
</tbody></table>
<h4 id="一些会影响-Task-行为的-mainfest-中-Activity-的属性"><a href="#一些会影响-Task-行为的-mainfest-中-Activity-的属性" class="headerlink" title="一些会影响 Task 行为的 mainfest 中 Activity 的属性"></a>一些会影响 Task 行为的 mainfest 中 Activity 的属性</h4><table>
<thead>
<tr>
<th align="center">属性名称</th>
<th align="center">可取值</th>
<th align="center">意义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">android:taskAffinity</td>
<td align="center">一个存在的包名</td>
<td align="center">表示该 Activity 与该包名具有亲缘，在该 Activity 启动的时候，会优先选择被添加进已经存在的具有亲缘关系的 Task 中。</td>
</tr>
<tr>
<td align="center">android:allowTaskReparenting</td>
<td align="center">true, false</td>
<td align="center">如果一个 Activity 的该属性值是 true，它先被一个外部 app 启动了，此时它存在于那个调用它的 app 的 Task 中，当与它有亲缘关系的 Task 被后台带回到前台的时候，系统会把它换到该 Task 中；如果值为 false 的话，就不会发生移动。</td>
</tr>
<tr>
<td align="center">android:alwaysRetainTaskState</td>
<td align="center">true, false</td>
<td align="center">正常情况下，当一个 Task 在后台待了很久之后，系统会把该 Task 的非根 Activity都清除，只保留根 Activity。但是假如根 Activity 的该属性值被设置为 true 的话，系统会保留该 Task 中所有的 Activity。</td>
</tr>
</tbody></table>
<h4 id="LaunchMode-总结"><a href="#LaunchMode-总结" class="headerlink" title="LaunchMode 总结"></a>LaunchMode 总结</h4><ul>
<li><p>LaunchMode 的作用，是让开发者可以在一定程度上决定自己的 Activity 该如何被系统实例化，从而来满足开发者的开发需求。</p>
</li>
<li><p>LaunchMode 一共分为两类，一类是普通开发者最常用的：standard 和 singleTop，其中 standard 是官方定义的最常见的也是默认的系统对 Activity 进行实例化的行为模式，singleTop 在 standard 的基础上进行了点小的改动，当目标栈的顶部有 Activity 的实例的时候将不再对该 Activity 进行初始化而是直接使用现成的 Activity 实例，因为有很多的使用场景是 standard 不太合适而 singleTop 比较合适的；另一个类别的是普通开发者不常使用的，singleTask 和 singleInstance，官方并不推荐在通常的场景中使用该类的 LaunchMode，只有在极少数特殊的情形中才去使用，该类 LaunchMode 的特点是 Activity 在系统中只会有一个实例存在，不同的地方在于 singleInstance 的 Activity 会独占一个 Task，而 singleTask 的则不会。</p>
</li>
<li><p>LaunchMode 可以在 mainfest 文件中静态地设置，同时，在代码中，通过 Intent 的几个 flag 也可以达到设置 LaunchMode 的目的。假如某一次启动一个 Activity 的时候，在 Intent 中指定了一个 LaunchMode，而且该 Activity 本身已经在 mainfest 文件中设置了 LaunchMode，那么这个时候系统会 以Intent 中指定的为准。Android 系统这样设计的目的，我想是为了让整个系统的 Activity 可以更方便地让其它 Activity（可以不再一个app内）进行调用，这与 Android 的开放的态度是一致的。</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Leo Yan</p>
  <div class="site-description" itemprop="description">离经不叛道，特立不独行。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">29</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2016 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Leo Yan</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
